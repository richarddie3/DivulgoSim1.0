<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DIVULGOSIM - Plataforma de Divulga√ß√£o</title>

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
        <link rel="stylesheet" href="style.css">
</head>
<body class="min-h-screen bg-gradient-to-br from-green-600 to-blue-900">
    <!-- === SISTEMA DE SEGURAN√áA ADICIONADO === -->
    <div id="securityShield" class="security-shield">
        <i class="fas fa-shield-alt"></i>
        <span>Sistema Protegido</span>
    </div>
    <!-- Header Original Completo -->
    <header id="appHeader" class="sticky top-0 z-40 glassmorphism">
        <div class="container mx-auto px-4 py-3">
            <div class="flex justify-between items-center">
                <h1 class="text-2xl font-bold text-white font-['Poppins']">DIVULGOSIM</h1>
                <div class="flex items-center gap-4">
                    <div id="headerActions" class="header-actions-desktop flex gap-2">
                        <!-- Ser√° preenchido dinamicamente -->
                    </div>
                </div>
            </div>
        </div>
    </header>
    <!-- Main Content -->
    <main id="mainContent" class="container mx-auto px-4 py-6">
        <!-- Conte√∫do ser√° renderizado aqui -->
    </main>
    <!-- Modal Container -->
    <div id="modalContainer" class="fixed inset-0 z-50 hidden backdrop-blur-sm">
        <!-- Modais ser√£o criados aqui -->
    </div>
    <!-- Alert Container -->
    <div id="alertContainer" class="fixed top-20 right-4 z-50 space-y-2">
        <!-- Alertas ser√£o criados aqui -->
    </div>
    <!-- Loading Overlay -->
    <div id="loadingOverlay" class="loading-overlay hidden">
        <div class="loading-spinner"></div>
    </div>
    <script>
        // === SISTEMA DE SEGURAN√áA ADICIONADO ===
        const SecuritySystem = {
            init() {
                this.injectSecurityHeaders();
                this.preventDevTools();
                this.detectTampering();
                this.monitorActivity();
            },
            injectSecurityHeaders() {
                const metaCSP = document.createElement('meta');
                metaCSP.httpEquiv = "Content-Security-Policy";
                metaCSP.content = "default-src 'self' https: 'unsafe-inline' 'unsafe-eval';";
                document.head.appendChild(metaCSP);
            },
            preventDevTools() {
                const devToolsCheck = setInterval(() => {
                    const widthThreshold = window.outerWidth - window.innerWidth > 160;
                    const heightThreshold = window.outerHeight - window.innerHeight > 160;

                    if (widthThreshold || heightThreshold) {
                        document.body.innerHTML = '<div class="flex items-center justify-center min-h-screen bg-red-600 text-white text-xl">‚ö†Ô∏è Acesso n√£o autorizado detectado</div>';
                        clearInterval(devToolsCheck);
                    }
                }, 1000);
            },
            detectTampering() {
                const observer = new MutationObserver((mutations) => {
                    mutations.forEach((mutation) => {
                        if (mutation.type === 'attributes' && mutation.attributeName === 'src') {
                            SecuritySystem.reportIncident('Altera√ß√£o de atributo suspeita detectada');
                        }
                    });
                });
                observer.observe(document, {
                    attributes: true,
                    childList: true,
                    subtree: true,
                    attributeFilter: ['src', 'href']
                });
            },
            monitorActivity() {
                let activityCount = 0;
                const resetActivity = () => activityCount = 0;
                setInterval(resetActivity, 1000);
                document.addEventListener('click', (e) => {
                    activityCount++;
                    if (activityCount > 50) {
                        SecuritySystem.reportIncident('Atividade suspeita de clique detectada');
                    }
                });
            },
            reportIncident(message) {
                console.warn('üö® Incidente de Seguran√ßa:', message);
                showAlert('Atividade suspeita detectada. Sistema protegido.', 'warning');
            },
            encryptData(data) {
                return btoa(JSON.stringify(data));
            },
            decryptData(encryptedData) {
                try {
                    return JSON.parse(atob(encryptedData));
                } catch {
                    return null;
                }
            }
        };
        // === VALIDA√á√ÉO DE INPUT SEGURA ADICIONADA ===
        const InputValidator = {
            sanitizeHTML(str) {
                const div = document.createElement('div');
                div.textContent = str;
                return div.innerHTML;
            },
            validateEmail(email) {
                const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
                return emailRegex.test(email);
            },
            validatePassword(password) {
                return password && password.length >= 6;
            },
            validateURL(url) {
                try {
                    new URL(url);
                    return true;
                } catch {
                    return false;
                }
            },
            preventXSS(input) {
                return input.replace(/[<>]/g, '');
            }
        };
        // === CONSTANTES ORIGINAIS COMPLETAS ===
        const Constants = {
            USER_TYPES: {
                ORGANIZER: 'organizador',
                PROMOTER: 'divulgador'
            },
            TASK_STATUS: {
                ACTIVE: 'active',
                COMPLETED: 'completed'
            },
            DEFAULT_IMAGES: {
                EVENT: 'https://images.unsplash.com/photo-1540575467063-178a50c2df87?ixlib=rb-4.0.3&auto=format&fit=crop&w=600&q=80',
                TASK: {
                    INSTAGRAM_FEED: 'https://images.unsplash.com/photo-1611162617213-7d7a39e9b1d7?ixlib=rb-4.0.3&auto=format&fit=crop&w=600&q=80',
                    INSTAGRAM_STORY: 'https://images.unsplash.com/photo-1611162617474-5b21e879e113?ixlib=rb-4.0.3&auto=format&fit=crop&w=600&q=80',
                    FACEBOOK_POST: 'https://images.unsplash.com/photo-1611162616305-c69b3fa7fbe0?ixlib=rb-4.0.3&auto=format&fit=crop&w=600&q=80'
                }
            },
            STATES: [
                'AC', 'AL', 'AP', 'AM', 'BA', 'CE', 'DF', 'ES', 'GO', 'MA', 
                'MT', 'MS', 'MG', 'PA', 'PB', 'PR', 'PE', 'PI', 'RJ', 'RN', 
                'RS', 'RO', 'RR', 'SC', 'SP', 'SE', 'TO'
            ],
            EVENT_IMAGES: [
                'https://images.unsplash.com/photo-1540575467063-178a50c2df87?ixlib=rb-4.0.3&auto=format&fit=crop&w=600&q=80',
                'https://images.unsplash.com/photo-1501281668745-f7f57925c3b4?ixlib=rb-4.0.3&auto=format&fit=crop&w=600&q=80',
                'https://images.unsplash.com/photo-1551434678-e076c223a692?ixlib=rb-4.0.3&auto=format&fit=crop&w=600&q=80',
                'https://images.unsplash.com/photo-1533174072545-7a4b6ad7a6c3?ixlib=rb-4.0.3&auto=format&fit=crop&w=600&q=80',
                'https://images.unsplash.com/photo-1530103862676-de8c9debad1d?ixlib=rb-4.0.3&auto=format&fit=crop&w=600&q=80'
            ]
        };
        // === CACHE SEGURO (MODIFICADO) ===
        const SecureCacheManager = {
            set(key, data, ttl = 3600000) {
                try {
                    const encrypted = SecuritySystem.encryptData({
                        data,
                        expiry: Date.now() + ttl
                    });
                    localStorage.setItem(`secure_${key}`, encrypted);
                    return true;
                } catch (error) {
                    console.warn('Cache seguro falhou:', error);
                    return false;
                }
            },
            get(key) {
                try {
                    const encrypted = localStorage.getItem(`secure_${key}`);
                    if (!encrypted) return null;
                    const item = SecuritySystem.decryptData(encrypted);
                    if (!item || Date.now() > item.expiry) {
                        localStorage.removeItem(`secure_${key}`);
                        return null;
                    }

                    return item.data;
                } catch (error) {
                    console.warn('Recupera√ß√£o de cache falhou:', error);
                    return null;
                }
            },
            remove(key) {
                try {
                    localStorage.removeItem(`secure_${key}`);
                    return true;
                } catch (error) {
                    console.warn('Falha ao remover do cache:', error);
                    return false;
                }
            }
        };
        // === SISTEMAS ORIGINAIS COMPLETOS MANTIDOS ===
        const ProfilePhotoManager = {
            async uploadProfilePhoto(file) {
                return new Promise((resolve) => {
                    const reader = new FileReader();
                    reader.onload = (e) => {
                        resolve(e.target.result);
                    };
                    reader.readAsDataURL(file);
                });
            },

            validatePhoto(file) {
                const maxSize = 5 * 1024 * 1024;
                const allowedTypes = ['image/jpeg', 'image/png', 'image/gif'];

                if (!allowedTypes.includes(file.type)) {
                    throw new Error('Tipo de arquivo n√£o permitido. Use JPEG, PNG ou GIF.');
                }

                if (file.size > maxSize) {
                    throw new Error('A imagem deve ter no m√°ximo 5MB.');
                }

                return true;
            }
        };
        const SocialProfileManager = {
            validateSocialUrl(platform, url) {
                const patterns = {
                    instagram: /^(https?:\/\/)?(www\.)?instagram\.com\/[a-zA-Z0-9._]+\/?$/,
                    facebook: /^(https?:\/\/)?(www\.)?facebook\.com\/[a-zA-Z0-9.]+\/?$/,
                    tiktok: /^(https?:\/\/)?(www\.)?tiktok\.com\/@[a-zA-Z0-9._]+\/?$/,
                    linkedin: /^(https?:\/\/)?(www\.)?linkedin\.com\/in\/[a-zA-Z0-9-]+\/?$/,
                    youtube: /^(https?:\/\/)?(www\.)?youtube\.com\/(c\/|channel\/|user\/)?[a-zA-Z0-9-]+\/?$/,
                    twitter: /^(https?:\/\/)?(www\.)?twitter\.com\/[a-zA-Z0-9_]+\/?$/
                };

                if (!url) return true;
                if (patterns[platform] && !patterns[platform].test(url)) {
                    throw new Error(`URL do ${platform} inv√°lida.`);
                }

                return true;
            },

            getSocialIcon(platform) {
                const icons = {
                    instagram: 'fab fa-instagram',
                    facebook: 'fab fa-facebook',
                    tiktok: 'fab fa-tiktok',
                    linkedin: 'fab fa-linkedin',
                    youtube: 'fab fa-youtube',
                    twitter: 'fab fa-twitter',
                    website: 'fas fa-globe'
                };
                return icons[platform] || 'fas fa-share-alt';
            }
        };
        // === ESTADO DA APLICA√á√ÉO ORIGINAL COMPLETO ===
        const AppState = {
            auth: {
                currentUser: null
            },

            events: new Map(),
            tasks: new Map(),
            submissions: [],
            userProfiles: new Map(),
            notifications: [],
            eventImages: new Map(),

            ui: {
                currentPage: 'welcome',
                promoterViewMode: 'events',
                profileSection: 'view',
                searchQuery: '',
                activeFilters: {
                    location: '',
                    category: '',
                    date: ''
                },
                profileTab: 'personal'
            },

            followedEventIds: new Set(),
            favoriteEventIds: new Set(),

            initializeDemoData() {
                // Eventos de demonstra√ß√£o COMPLETOS
                const demoEvents = [
                    {
                        id: 'event1',
                        name: 'Festival de M√∫sica SP',
                        location: 'S√£o Paulo, SP',
                        start_date: '2024-11-15',
                        end_date: '2024-11-17',
                        description: 'O maior festival de m√∫sica eletr√¥nica do Brasil! Com DJs internacionais e nacionais, luzes incr√≠veis e uma experi√™ncia √∫nica.',
                        organizer_id: 'org1',
                        is_public: true,
                        image: 'https://images.unsplash.com/photo-1501281668745-f7f57925c3b4?ixlib=rb-4.0.3&auto=format&fit=crop&w=600&q=80',
                        tickets: [
                            { id: 'ticket1', name: 'Lote 1 - Promocional', price: 50.00, quantity: 100 },
                            { id: 'ticket2', name: 'Lote 2 - Inteira', price: 80.00, quantity: 200 }
                        ],
                        category: 'M√∫sica'
                    },
                    {
                        id: 'event2',
                        name: 'Workshop de Marketing Digital',
                        location: 'Rio de Janeiro, RJ',
                        start_date: '2024-12-01',
                        end_date: '2024-12-01',
                        description: 'Aprenda as melhores estrat√©gias de marketing digital com especialistas do mercado. Inclui certificado.',
                        organizer_id: 'org1',
                        is_public: true,
                        image: 'https://images.unsplash.com/photo-1551434678-e076c223a692?ixlib=rb-4.0.3&auto=format&fit=crop&w=600&q=80',
                        tickets: [
                            { id: 'ticket3', name: 'Lote √önico', price: 120.00, quantity: 50 }
                        ],
                        category: 'Educa√ß√£o'
                    }
                ];
                demoEvents.forEach(event => {
                    this.events.set(event.id, event);
                    this.eventImages.set(event.id, [event.image, ...Constants.EVENT_IMAGES.slice(0, 3)]);
                });
                // Tarefas de demonstra√ß√£o COMPLETAS
                const demoTasks = [
                    {
                        id: 'task1',
                        event_id: 'event1',
                        title: 'Post no Instagram',
                        description: 'Compartilhe o evento em seu feed com as hashtags #DivulgoSim #FestivalSP #M√∫sicaEletr√¥nica',
                        deadline: '2024-11-10',
                        status: 'active',
                        social_media: 'instagram',
                        task_type: 'feed',
                        image: Constants.DEFAULT_IMAGES.TASK.INSTAGRAM_FEED
                    },
                    {
                        id: 'task2',
                        event_id: 'event1',
                        title: 'Story no Instagram',
                        description: 'Fa√ßa um story marcando o perfil do evento e usando o sticker de localiza√ß√£o',
                        deadline: '2024-11-12',
                        status: 'active',
                        social_media: 'instagram',
                        task_type: 'story',
                        image: Constants.DEFAULT_IMAGES.TASK.INSTAGRAM_STORY
                    }
                ];
                demoTasks.forEach(task => this.tasks.set(task.id, task));
                // Perfis de demonstra√ß√£o COMPLETOS
                const demoProfiles = {
                    'org1': {
                        name: 'Jo√£o Organizador',
                        title: 'Organizador de Eventos',
                        bio: 'Especialista em criar experi√™ncias memor√°veis atrav√©s de eventos √∫nicos e bem organizados.',
                        email: 'organizador@demo.com',
                        phone: '(11) 98765-4321',
                        profilePicture: null,
                        socialLinks: {
                            linkedin: 'https://linkedin.com/in/joaoorganizador',
                            instagram: 'https://instagram.com/joaoorganizador'
                        },
                        personalInfo: {
                            fullName: 'Jo√£o Silva',
                            birthDate: '1985-05-15',
                            cpf: '123.456.789-00',
                            rg: '12.345.678-9',
                            gender: 'Masculino',
                            maritalStatus: 'Casado'
                        },
                        address: {
                            cep: '01234-567',
                            street: 'Rua das Flores',
                            number: '123',
                            complement: 'Apto 45',
                            neighborhood: 'Centro',
                            city: 'S√£o Paulo',
                            state: 'SP',
                            country: 'Brasil'
                        },
                        medicalInfo: {
                            bloodType: 'A+',
                            allergies: 'P√≥len, amendoim',
                            medications: 'Nenhum',
                            conditions: 'Nenhuma',
                            emergencyContact: {
                                name: 'Maria Silva',
                                phone: '(11) 91234-5678',
                                relationship: 'Esposa'
                            },
                            healthInsurance: 'Unimed',
                            additionalNotes: 'Nenhuma observa√ß√£o adicional'
                        }
                    },
                    'div1': {
                        name: 'Maria Divulgadora',
                        title: 'Divulgadora Digital',
                        bio: 'Especialista em marketing digital e divulga√ß√£o de eventos nas redes sociais.',
                        email: 'divulgador@demo.com',
                        phone: '(11) 91234-5678',
                        profilePicture: null,
                        socialLinks: {
                            instagram: 'https://instagram.com/mariadivulgadora',
                            tiktok: 'https://tiktok.com/@mariadivulgadora'
                        },
                        personalInfo: {
                            fullName: 'Maria Santos',
                            birthDate: '1990-08-22',
                            cpf: '987.654.321-00',
                            rg: '98.765.432-1',
                            gender: 'Feminino',
                            maritalStatus: 'Solteira'
                        },
                        address: {
                            cep: '04567-890',
                            street: 'Avenida Paulista',
                            number: '1000',
                            complement: 'Conjunto 101',
                            neighborhood: 'Bela Vista',
                            city: 'S√£o Paulo',
                            state: 'SP',
                            country: 'Brasil'
                        },
                        medicalInfo: {
                            bloodType: 'O-',
                            allergies: 'Nenhuma',
                            medications: 'Anticoncepcional',
                            conditions: 'Nenhuma',
                            emergencyContact: {
                                name: 'Carlos Santos',
                                phone: '(11) 92345-6789',
                                relationship: 'Pai'
                            },
                            healthInsurance: 'Amil',
                            additionalNotes: 'Controle m√©dico regular'
                        }
                    }
                };
                Object.entries(demoProfiles).forEach(([id, profile]) => {
                    this.userProfiles.set(id, profile);
                });
            }
        };
        // === SISTEMA DE AUTENTICA√á√ÉO ORIGINAL COMPLETO ===
        const AuthManager = {
            users: new Map(),
            init() {
                const demoUsers = [
                    {
                        id: 'org1',
                        email: 'organizador@demo.com',
                        password: '123456',
                        name: 'Jo√£o Organizador',
                        type: Constants.USER_TYPES.ORGANIZER
                    },
                    {
                        id: 'div1',
                        email: 'divulgador@demo.com',
                        password: '123456',
                        name: 'Maria Divulgadora',
                        type: Constants.USER_TYPES.PROMOTER
                    }
                ];
                demoUsers.forEach(user => this.users.set(user.id, user));

                const cachedUser = SecureCacheManager.get('currentUser');
                if (cachedUser) {
                    AppState.auth.currentUser = cachedUser;
                }
            },
            login(email, password) {
                // VALIDA√á√ÉO DE SEGURAN√áA ADICIONADA
                if (!InputValidator.validateEmail(email)) {
                    throw new Error('Email inv√°lido');
                }
                const user = Array.from(this.users.values()).find(u => 
                    u.email === email && u.password === password
                );

                if (!user) {
                    SecuritySystem.reportIncident('Tentativa de login falhou: ' + email);
                    throw new Error('Email ou senha incorretos');
                }
                AppState.auth.currentUser = user;
                AppState.ui.currentPage = user.type === Constants.USER_TYPES.ORGANIZER ? 'dashboard' : 'explore';

                SecureCacheManager.set('currentUser', user);
                this.initializeUserData(user);

                showAlert(`Bem-vindo(a), ${user.name}!`, 'success');
                return user;
            },
            register(userData) {
                // VALIDA√á√ÉO DE SEGURAN√áA ADICIONADA
                if (!InputValidator.validateEmail(userData.email)) {
                    throw new Error('Email inv√°lido');
                }
                if (!InputValidator.validatePassword(userData.password)) {
                    throw new Error('Senha deve ter pelo menos 6 caracteres');
                }
                if (Array.from(this.users.values()).some(u => u.email === userData.email)) {
                    throw new Error('Email j√° cadastrado');
                }
                const newUser = {
                    id: 'user_' + Date.now(),
                    ...userData
                };
                this.users.set(newUser.id, newUser);
                this.createDefaultProfile(newUser);

                AppState.auth.currentUser = newUser;
                AppState.ui.currentPage = newUser.type === Constants.USER_TYPES.ORGANIZER ? 'dashboard' : 'explore';

                SecureCacheManager.set('currentUser', newUser);

                showAlert('Cadastro realizado com sucesso!', 'success');
                return newUser;
            },
            createDefaultProfile(user) {
                const defaultProfile = {
                    name: user.name,
                    title: user.type === Constants.USER_TYPES.ORGANIZER ? 'Organizador de Eventos' : 'Divulgador Digital',
                    bio: user.type === Constants.USER_TYPES.ORGANIZER 
                        ? 'Especialista em criar experi√™ncias memor√°veis atrav√©s de eventos √∫nicos e bem organizados.'
                        : 'Especialista em marketing digital e divulga√ß√£o de eventos nas redes sociais.',
                    email: user.email,
                    phone: '(00) 00000-0000',
                    profilePicture: null,
                    socialLinks: {},
                    personalInfo: {
                        fullName: user.name,
                        birthDate: '',
                        cpf: '',
                        rg: '',
                        gender: '',
                        maritalStatus: ''
                    },
                    address: {
                        cep: '',
                        street: '',
                        number: '',
                        complement: '',
                        neighborhood: '',
                        city: '',
                        state: '',
                        country: 'Brasil'
                    },
                    medicalInfo: {
                        bloodType: '',
                        allergies: '',
                        medications: '',
                        conditions: '',
                        emergencyContact: {
                            name: '',
                            phone: '',
                            relationship: ''
                        },
                        healthInsurance: '',
                        additionalNotes: ''
                    }
                };
                AppState.userProfiles.set(user.id, defaultProfile);
            },
            initializeUserData(user) {
                if (user.type === Constants.USER_TYPES.PROMOTER) {
                    AppState.notifications = [
                        {
                            id: 'notif1',
                            userId: user.id,
                            title: 'üéâ Novo Convite de Evento',
                            message: 'Voc√™ foi convidado para divulgar o Festival de M√∫sica SP',
                            type: 'invite',
                            read: false,
                            createdAt: new Date(Date.now() - 2 * 60 * 60 * 1000).toISOString(),
                            data: { eventId: 'event1' }
                        }
                    ];
                }
            },
            logout() {
                AppState.auth.currentUser = null;
                AppState.ui.currentPage = 'welcome';
                AppState.ui.profileSection = 'view';
                SecureCacheManager.remove('currentUser');
                showAlert('Logout realizado com sucesso!', 'info');
                Renderer.renderApp();
            },
            isLoggedIn() {
                return AppState.auth.currentUser !== null;
            },
            getCurrentUser() {
                return AppState.auth.currentUser;
            }
        };
        // === SISTEMA DE RECUPERA√á√ÉO DE SENHA ORIGINAL COMPLETO ===
        const PasswordRecoveryManager = {
            resetTokens: new Map(),

            generateResetToken(email) {
                const token = Math.random().toString(36).substring(2, 15) + 
                             Math.random().toString(36).substring(2, 15);

                this.resetTokens.set(token, {
                    email: email,
                    expires: Date.now() + 3600000
                });

                return token;
            },

            validateResetToken(token) {
                const tokenData = this.resetTokens.get(token);
                if (!tokenData) return false;

                if (Date.now() > tokenData.expires) {
                    this.resetTokens.delete(token);
                    return false;
                }

                return tokenData.email;
            },

            resetPassword(token, newPassword) {
                const email = this.validateResetToken(token);
                if (!email) {
                    throw new Error('Token inv√°lido ou expirado.');
                }

                const user = Array.from(AuthManager.users.values()).find(u => u.email === email);
                if (!user) {
                    throw new Error('Usu√°rio n√£o encontrado.');
                }

                user.password = newPassword;
                this.resetTokens.delete(token);

                return true;
            },

            sendResetEmail(email) {
                const token = this.generateResetToken(email);
                const resetLink = `${window.location.origin}#recovery?token=${token}`;

                console.log(`Email de recupera√ß√£o enviado para: ${email}`);
                console.log(`Link de recupera√ß√£o: ${resetLink}`);

                return new Promise((resolve) => {
                    setTimeout(() => {
                        resolve(true);
                    }, 2000);
                });
            }
        };
        // === HELPERS REUTILIZ√ÅVEIS ORIGINAIS COMPLETOS ===
        const FormatHelper = {
            date(dateString) {
                try {
                    return new Date(dateString).toLocaleDateString('pt-BR');
                } catch (error) {
                    return 'Data inv√°lida';
                }
            },

            currency(amount) {
                try {
                    return `R$ ${parseFloat(amount || 0).toFixed(2)}`;
                } catch (error) {
                    return 'R$ 0,00';
                }
            },

            timeAgo(dateString) {
                try {
                    const date = new Date(dateString);
                    const now = new Date();
                    const diffMs = now - date;
                    const diffMins = Math.floor(diffMs / 60000);
                    const diffHours = Math.floor(diffMs / 3600000);
                    const diffDays = Math.floor(diffMs / 86400000);

                    if (diffMins < 1) return 'Agora mesmo';
                    if (diffMins < 60) return `${diffMins} min atr√°s`;
                    if (diffHours < 24) return `${diffHours} h atr√°s`;
                    if (diffDays < 7) return `${diffDays} dias atr√°s`;

                    return date.toLocaleDateString('pt-BR');
                } catch (error) {
                    return 'Data inv√°lida';
                }
            },

            truncate(text, maxLength = 100) {
                if (!text || text.length <= maxLength) return text;
                return text.substring(0, maxLength) + '...';
            }
        };
        const PerformanceHelper = {
            debounce(func, wait) {
                let timeout;
                return function executedFunction(...args) {
                    const later = () => {
                        clearTimeout(timeout);
                        func(...args);
                    };
                    clearTimeout(timeout);
                    timeout = setTimeout(later, wait);
                };
            }
        };
        const TemplateHelpers = {
            condition(condition, trueTemplate, falseTemplate = '') {
                return condition ? trueTemplate : falseTemplate;
            },

            loop(array, itemTemplate) {
                if (!array || !Array.isArray(array)) return '';
                return array.map(itemTemplate).join('');
            }
        };
        // === GERENCIADOR DE EVENTOS ORIGINAL COMPLETO ===
        const EventManager = {
            getPublicEvents() {
                let events = Array.from(AppState.events.values()).filter(e => e.is_public);

                if (AppState.ui.searchQuery) {
                    const query = AppState.ui.searchQuery.toLowerCase();
                    events = events.filter(event => 
                        event.name.toLowerCase().includes(query) ||
                        event.description.toLowerCase().includes(query) ||
                        event.location.toLowerCase().includes(query)
                    );
                }

                if (AppState.ui.activeFilters.location) {
                    events = events.filter(event => 
                        event.location.includes(AppState.ui.activeFilters.location)
                    );
                }

                if (AppState.ui.activeFilters.category) {
                    events = events.filter(event => 
                        event.category === AppState.ui.activeFilters.category
                    );
                }

                return events;
            },
            getOrganizerEvents(organizerId) {
                return Array.from(AppState.events.values()).filter(e => e.organizer_id === organizerId);
            },
            getEventById(eventId) {
                return AppState.events.get(eventId);
            },
            createEvent(eventData) {
                const newEvent = {
                    id: 'event_' + Date.now(),
                    ...eventData,
                    organizer_id: AppState.auth.currentUser.id,
                    is_public: true,
                    created_at: new Date().toISOString()
                };
                AppState.events.set(newEvent.id, newEvent);
                return newEvent;
            },
            updateEvent(eventId, eventData) {
                const event = AppState.events.get(eventId);
                if (event) {
                    const updatedEvent = { 
                        ...event, 
                        ...eventData,
                        updated_at: new Date().toISOString()
                    };
                    AppState.events.set(eventId, updatedEvent);
                    return updatedEvent;
                }
                return null;
            },
            deleteEvent(eventId) {
                if (confirm('Tem certeza que deseja excluir este evento?')) {
                    AppState.events.delete(eventId);
                    Array.from(AppState.tasks.entries()).forEach(([taskId, task]) => {
                        if (task.event_id === eventId) {
                            AppState.tasks.delete(taskId);
                        }
                    });
                    showAlert('Evento exclu√≠do com sucesso!', 'success');
                    Renderer.renderApp();
                }
            },
            toggleFollow(eventId) {
                if (AppState.followedEventIds.has(eventId)) {
                    AppState.followedEventIds.delete(eventId);
                    showAlert('Evento removido da sua lista!', 'info');
                } else {
                    AppState.followedEventIds.add(eventId);
                    showAlert('Agora voc√™ est√° seguindo este evento!', 'success');
                }
                Renderer.renderApp();
            },
            toggleFavorite(eventId) {
                if (AppState.favoriteEventIds.has(eventId)) {
                    AppState.favoriteEventIds.delete(eventId);
                    showAlert('Evento removido dos favoritos!', 'info');
                } else {
                    AppState.favoriteEventIds.add(eventId);
                    showAlert('Evento adicionado aos favoritos!', 'success');
                }
                Renderer.renderApp();
            },
            getFollowedEvents() {
                return Array.from(AppState.followedEventIds)
                    .map(id => this.getEventById(id))
                    .filter(event => event !== undefined);
            },
            getFavoriteEvents() {
                return Array.from(AppState.favoriteEventIds)
                    .map(id => this.getEventById(id))
                    .filter(event => event !== undefined);
            },
            getEventImages(eventId) {
                return AppState.eventImages.get(eventId) || [];
            },
            addEventImage(eventId, imageUrl) {
                const images = this.getEventImages(eventId);
                images.push(imageUrl);
                AppState.eventImages.set(eventId, images);
                return images;
            },
            getEventCategories() {
                const categories = new Set();
                Array.from(AppState.events.values()).forEach(event => {
                    if (event.category) {
                        categories.add(event.category);
                    }
                });
                return Array.from(categories);
            }
        };
        // === TEMPLATES ORIGINAIS COMPLETOS ===
        const EventTemplates = {
            card(event, options = {}) {
                const { showFollowButton = false, showManageButtons = false } = options;
                const eventTasks = Array.from(AppState.tasks.values()).filter(t => t.event_id === event.id);
                const minPrice = event.tickets?.length > 0 
                    ? Math.min(...event.tickets.map(t => t.price))
                    : 0;
                const isFollowing = AppState.followedEventIds.has(event.id);
                const isFavorite = AppState.favoriteEventIds.has(event.id);
                return `
                    <div class="event-card fade-in">
                        ${!showManageButtons ? `
                            <button class="favorite-btn ${isFavorite ? 'active' : ''}" onclick="EventManager.toggleFavorite('${event.id}')">
                                <i class="fas fa-heart"></i>
                            </button>
                        ` : ''}
                        <img src="${event.image}" alt="${event.name}" class="event-card-image lazy-image" onload="this.classList.add('loaded')">
                        <div class="event-card-content">
                            <h3 class="event-card-title">${event.name}</h3>
                            <div class="event-card-info">
                                <div class="event-card-meta">
                                    <i class="fas fa-map-marker-alt"></i>
                                    <span>${event.location}</span>
                                </div>
                                <div class="event-card-meta">
                                    <i class="fas fa-calendar-alt"></i>
                                    <span>${FormatHelper.date(event.start_date)}</span>
                                </div>
                                ${TemplateHelpers.condition(minPrice > 0, `
                                    <div class="event-card-meta">
                                        <i class="fas fa-ticket-alt"></i>
                                        <span>A partir de ${FormatHelper.currency(minPrice)}</span>
                                    </div>
                                `)}
                                <p class="event-card-description">${FormatHelper.truncate(event.description, 120)}</p>
                            </div>
                            <div class="event-card-actions">
                                <div class="flex items-center justify-between mb-2">
                                    <span class="bg-blue-900 text-white px-3 py-1 rounded-full text-sm">
                                        ${eventTasks.length} tarefas
                                    </span>
                                    ${TemplateHelpers.condition(isFollowing && !showManageButtons, 
                                        '<span class="text-green-400 text-sm font-semibold">‚úì Seguindo</span>'
                                    )}
                                </div>
                                ${this.getEventActions(event, { showFollowButton, showManageButtons, isFollowing })}
                            </div>
                        </div>
                    </div>
                `;
            },
            getEventActions(event, options) {
                const { showFollowButton, showManageButtons, isFollowing } = options;
                if (showManageButtons) {
                    return `
                        <div class="flex gap-2">
                            <button onclick="UI.showEventManagementModal('${event.id}')" class="flex-1 btn btn-primary">
                                Gerenciar
                            </button>
                            <button onclick="UI.showEventEditModal('${event.id}')" class="btn btn-success">
                                Editar
                            </button>
                            <button onclick="EventManager.deleteEvent('${event.id}')" class="btn btn-danger">
                                Excluir
                            </button>
                        </div>
                    `;
                }
                if (showFollowButton) {
                    return `
                        <button onclick="EventManager.toggleFollow('${event.id}')" class="event-card-button ${isFollowing ? 'following' : 'follow'}">
                            ${isFollowing ? '‚úì Seguindo' : '+ Seguir Evento'}
                        </button>
                    `;
                }
                return `
                    <button onclick="UI.showLoginModal()" class="event-card-button follow">
                        Quero Divulgar
                    </button>
                `;
            }
        };
        const TaskTemplates = {
            card(task, options = {}) {
                const { showSubmission = false } = options;
                const userSubmissions = TaskManager.getUserSubmissions(AppState.auth.currentUser?.id);
                const isCompleted = userSubmissions.some(sub => sub.task_id === task.id);
                return `
                    <div class="bg-white/10 backdrop-blur-sm rounded-xl p-6 border border-white/20 fade-in">
                        <div class="flex gap-4">
                            <div class="flex-shrink-0">
                                <img src="${task.image}" alt="${task.title}" class="task-image w-24 h-24 object-cover rounded-lg lazy-image" onload="this.classList.add('loaded')">
                                ${TemplateHelpers.condition(task.image, `
                                    <button onclick="Actions.downloadImage('${task.image}', '${task.title}')" class="w-full mt-2 btn btn-primary text-sm">
                                        üì• Baixar Imagem
                                    </button>
                                `)}
                            </div>
                            <div class="flex-1">
                                <div class="flex justify-between items-start mb-2">
                                    <div>
                                        <h4 class="text-lg font-bold text-white">${task.title}</h4>
                                        <p class="text-gray-300">${TaskManager.getSocialMediaDisplayName(task.social_media)} - ${TaskManager.getTaskTypeDisplayName(task.task_type)}</p>
                                    </div>
                                    <div class="flex gap-2">
                                        ${isCompleted ? 
                                            '<span class="bg-green-500 text-white px-2 py-1 rounded text-sm">Conclu√≠da</span>' : 
                                            '<span class="bg-yellow-500 text-white px-2 py-1 rounded text-sm">Pendente</span>'
                                        }
                                    </div>
                                </div>
                                <div class="mb-3">
                                    <div class="flex justify-between items-center mb-1">
                                        <span class="text-gray-300">Descri√ß√£o:</span>
                                        <button onclick="Actions.copyToClipboard('${task.description.replace(/'/g, "\\'")}')" class="btn btn-secondary text-xs">
                                            üìã Copiar
                                        </button>
                                    </div>
                                    <p class="text-gray-400 text-sm bg-white/5 p-2 rounded">${task.description}</p>
                                </div>
                                <div class="flex justify-between items-center">
                                    <p class="text-gray-400 text-sm">Prazo: ${FormatHelper.date(task.deadline)}</p>
                                    <div>
                                        ${isCompleted ? `
                                            <button onclick="TaskManager.undoSubmission('${task.id}')" class="btn btn-secondary text-sm">
                                                Refazer
                                            </button>
                                        ` : `
                                            <button onclick="UI.showTaskSubmissionModal('${task.id}')" class="btn btn-warning text-sm">
                                                Enviar Tarefa
                                            </button>
                                        `}
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            }
        };
        // === GERENCIADOR DE TAREFAS ORIGINAL COMPLETO ===
        const TaskManager = {
            getEventTasks(eventId) {
                return Array.from(AppState.tasks.values()).filter(t => t.event_id === eventId);
            },
            createTask(taskData) {
                const newTask = {
                    id: 'task_' + Date.now(),
                    status: Constants.TASK_STATUS.ACTIVE,
                    created_at: new Date().toISOString(),
                    ...taskData
                };
                AppState.tasks.set(newTask.id, newTask);
                return newTask;
            },
            getDefaultImage(socialMedia, taskType) {
                const imageMap = {
                    instagram: {
                        feed: Constants.DEFAULT_IMAGES.TASK.INSTAGRAM_FEED,
                        story: Constants.DEFAULT_IMAGES.TASK.INSTAGRAM_STORY
                    },
                    facebook: {
                        post: Constants.DEFAULT_IMAGES.TASK.FACEBOOK_POST
                    }
                };
                return imageMap[socialMedia]?.[taskType] || Constants.DEFAULT_IMAGES.EVENT;
            },
            getSocialMediaDisplayName(socialMedia) {
                const names = {
                    instagram: 'Instagram',
                    facebook: 'Facebook',
                    tiktok: 'TikTok',
                    twitter: 'Twitter'
                };
                return names[socialMedia] || socialMedia;
            },
            getTaskTypeDisplayName(taskType) {
                const names = {
                    feed: 'Feed',
                    story: 'Story',
                    reel: 'Reel',
                    post: 'Post',
                    video: 'V√≠deo'
                };
                return names[taskType] || taskType;
            },
            submitTask(taskId, link) {
                const submission = {
                    id: 'sub_' + Date.now(),
                    task_id: taskId,
                    user_id: AppState.auth.currentUser.id,
                    user_name: AppState.auth.currentUser.name,
                    link: link,
                    status: 'completed',
                    submitted_at: new Date().toISOString()
                };
                AppState.submissions.push(submission);
                return submission;
            },
            getTaskSubmissions(taskId) {
                return AppState.submissions.filter(s => s.task_id === taskId);
            },
            getUserSubmissions(userId) {
                return AppState.submissions.filter(s => s.user_id === userId);
            },
            undoSubmission(taskId) {
                const userSubmissions = this.getUserSubmissions(AppState.auth.currentUser.id);
                const submission = userSubmissions.find(sub => sub.task_id === taskId);
                if (submission) {
                    AppState.submissions = AppState.submissions.filter(s => s.id !== submission.id);
                    showAlert('Tarefa reaberta para envio!', 'info');
                    Renderer.renderApp();
                }
            }
        };
        // === SISTEMA DE CARROSSEL ORIGINAL COMPLETO ===
        const CarouselManager = {
            currentSlide: 0,
            totalSlides: 0,

            initCarousel(containerId, images) {
                this.currentSlide = 0;
                this.totalSlides = images.length;

                const container = document.getElementById(containerId);
                if (!container) return;

                container.innerHTML = `
                    <div class="reels-carousel">
                        <div class="reels-container" id="reelsContainer">
                            ${images.map((image, index) => `
                                <div class="reel-slide ${index === 0 ? 'active' : ''}">
                                    <img src="${image}" alt="Imagem do evento ${index + 1}" class="reel-image lazy-image" onload="this.classList.add('loaded')">
                                    <button class="download-image-btn" onclick="Actions.downloadImage('${image}', 'imagem-evento-${index + 1}')">
                                        <i class="fas fa-download"></i>
                                    </button>
                                </div>
                            `).join('')}
                        </div>
                        <div class="carousel-controls">
                            <button class="carousel-btn prev-btn" onclick="CarouselManager.prevSlide('${containerId}')">
                                <i class="fas fa-chevron-left"></i>
                            </button>
                            <button class="carousel-btn next-btn" onclick="CarouselManager.nextSlide('${containerId}')">
                                <i class="fas fa-chevron-right"></i>
                            </button>
                        </div>
                    </div>
                    <div class="carousel-indicators" id="carouselIndicators">
                        ${images.map((_, index) => `
                            <div class="carousel-indicator ${index === 0 ? 'active' : ''}" onclick="CarouselManager.goToSlide('${containerId}', ${index})"></div>
                        `).join('')}
                    </div>
                `;

                this.updateCarousel(containerId);
            },

            nextSlide(containerId) {
                this.currentSlide = (this.currentSlide + 1) % this.totalSlides;
                this.updateCarousel(containerId);
            },

            prevSlide(containerId) {
                this.currentSlide = (this.currentSlide - 1 + this.totalSlides) % this.totalSlides;
                this.updateCarousel(containerId);
            },

            goToSlide(containerId, slideIndex) {
                this.currentSlide = slideIndex;
                this.updateCarousel(containerId);
            },

            updateCarousel(containerId) {
                const container = document.getElementById(containerId);
                if (!container) return;

                const reelsContainer = container.querySelector('#reelsContainer');
                const indicators = container.querySelectorAll('.carousel-indicator');

                if (reelsContainer) {
                    reelsContainer.style.transform = `translateX(-${this.currentSlide * 100}%)`;
                }

                indicators.forEach((indicator, index) => {
                    indicator.classList.toggle('active', index === this.currentSlide);
                });
            }
        };
        // === RENDERIZADOR ORIGINAL COMPLETO ===
        const Renderer = {
            renderApp() {
                this.renderHeader();
                this.renderMainContent();
                this.initializeLazyLoading();
            },
            renderHeader() {
                const headerActions = document.getElementById('headerActions');
                if (!headerActions) return;
                if (!AuthManager.isLoggedIn()) {
                    headerActions.innerHTML = `
                        <div class="flex gap-3">
                            <button onclick="UI.showLoginModal()" class="btn btn-primary">
                                Entrar
                            </button>
                            <button onclick="UI.showRegisterModal()" class="btn btn-warning">
                                Cadastrar
                            </button>
                        </div>
                    `;
                } else {
                    const user = AuthManager.getCurrentUser();

                    headerActions.innerHTML = `
                        <div class="flex items-center gap-4">
                            <button onclick="ProfileManager.openProfile()" class="btn btn-success">
                                <i class="fas fa-user-circle"></i>
                                Meu Perfil
                            </button>

                            <div class="relative">
                                <button onclick="UI.toggleNotifications()" class="btn btn-outline relative">
                                    <i class="fas fa-bell"></i>
                                    <span class="notification-badge" style="display: none"></span>
                                </button>
                                <div id="notificationsDropdown" class="notification-dropdown hidden">
                                    <!-- Notifica√ß√µes ser√£o carregadas aqui -->
                                </div>
                            </div>

                            <button onclick="AuthManager.logout()" class="btn btn-danger">
                                <i class="fas fa-sign-out-alt"></i> Sair
                            </button>
                        </div>
                    `;
                    NotificationSystem.renderNotifications();
                }
            },
            renderMainContent() {
                const mainContent = document.getElementById('mainContent');
                if (!mainContent) return;
                if (!AuthManager.isLoggedIn()) {
                    this.renderPublicView();
                } else if (AppState.ui.currentPage === 'profile') {
                    this.renderProfilePage();
                } else {
                    const user = AuthManager.getCurrentUser();
                    if (user.type === Constants.USER_TYPES.ORGANIZER) {
                        this.renderOrganizerDashboard();
                    } else {
                        this.renderPromoterDashboard();
                    }
                }
            },
            renderPublicView() {
                const publicEvents = EventManager.getPublicEvents();
                const mainContent = document.getElementById('mainContent');

                mainContent.innerHTML = `
                    <div class="max-w-6xl mx-auto">
                        <div class="text-center text-white mb-12">
                            <h2 class="text-4xl font-bold mb-4 font-['Poppins']">Descubra Eventos Incr√≠veis</h2>
                            <p class="text-xl text-gray-300 mb-8">Conecte-se com organizadores e ajude a divulgar eventos que voc√™ ama</p>
                            <div class="bg-white/10 backdrop-blur-sm rounded-xl p-6 border border-white/20 max-w-2xl mx-auto mb-8">
                                <h3 class="text-2xl font-bold mb-4 font-['Poppins']">üîç Comece a Divulgar Hoje!</h3>
                                <p class="text-gray-300 mb-6">Cadastre-se gratuitamente e escolha eventos para divulgar</p>
                                <div class="flex gap-4 justify-center">
                                    <button onclick="UI.showRegisterModal('${Constants.USER_TYPES.PROMOTER}')" class="btn btn-warning">
                                        üîç Quero Divulgar
                                    </button>
                                    <button onclick="UI.showRegisterModal('${Constants.USER_TYPES.ORGANIZER}')" class="btn btn-primary">
                                        üí¨ Sou Organizador
                                    </button>
                                </div>
                            </div>
                        </div>

                        <!-- Sistema de Busca -->
                        <div class="search-container">
                            <input type="text" id="searchInput" class="search-input" placeholder="Buscar eventos..." value="${AppState.ui.searchQuery}">
                            <button class="search-btn" onclick="SearchManager.performSearch()">
                                <i class="fas fa-search"></i>
                            </button>
                        </div>

                        <div class="filter-container">
                            <button class="filter-btn ${!AppState.ui.activeFilters.location ? 'active' : ''}" onclick="SearchManager.clearFilter('location')">
                                Todas as Cidades
                            </button>
                            ${EventManager.getEventCategories().map(category => `
                                <button class="filter-btn ${AppState.ui.activeFilters.category === category ? 'active' : ''}" onclick="SearchManager.setFilter('category', '${category}')">
                                    ${category}
                                </button>
                            `).join('')}
                        </div>

                        <div class="events-grid">
                            ${publicEvents.length > 0 ? 
                                TemplateHelpers.loop(publicEvents, event => 
                                    EventTemplates.card(event, { showFollowButton: false })
                                ) : 
                                this.renderEmptyState('eventos', 'busca')
                            }
                        </div>
                    </div>
                `;
                const searchInput = document.getElementById('searchInput');
                if (searchInput) {
                    const debouncedSearch = PerformanceHelper.debounce(SearchManager.performSearch, 300);
                    searchInput.addEventListener('input', debouncedSearch);
                }
            },
            renderOrganizerDashboard() {
                const userEvents = EventManager.getOrganizerEvents(AppState.auth.currentUser.id);
                const mainContent = document.getElementById('mainContent');

                mainContent.innerHTML = `
                    <div class="max-w-6xl mx-auto">
                        <div class="flex justify-between items-center mb-8">
                            <h2 class="text-3xl font-bold text-white font-['Poppins']">Meus Eventos</h2>
                            <button onclick="UI.showEventCreateModal()" class="btn btn-warning">
                                + Criar Evento
                            </button>
                        </div>
                        ${userEvents.length === 0 ? this.renderEmptyState('eventos', 'organizador') : `
                            <div class="events-grid">
                                ${TemplateHelpers.loop(userEvents, event => 
                                    EventTemplates.card(event, { showManageButtons: true })
                                )}
                            </div>
                        `}
                    </div>
                `;
            },
            renderPromoterDashboard() {
                const mainContent = document.getElementById('mainContent');
                const showEvents = AppState.ui.promoterViewMode === 'events';
                const showMyEvents = AppState.ui.promoterViewMode === 'myEvents';
                const showFavorites = AppState.ui.promoterViewMode === 'favorites';
                mainContent.innerHTML = `
                    <div class="promoter-view-container">
                        <div class="promoter-header">
                            <h2 class="text-3xl font-bold text-white text-center font-['Poppins']">√Årea do Divulgador</h2>
                            <div class="promoter-tabs">
                                <button onclick="UI.setPromoterView('events')" class="promoter-tab ${showEvents ? 'active' : ''}">
                                    üìÖ Eventos Dispon√≠veis
                                </button>
                                <button onclick="UI.setPromoterView('myEvents')" class="promoter-tab ${showMyEvents ? 'active' : ''}">
                                    ‚≠ê Meus Eventos
                                </button>
                                <button onclick="UI.setPromoterView('favorites')" class="promoter-tab ${showFavorites ? 'active' : ''}">
                                    ‚ù§Ô∏è Favoritos
                                </button>
                            </div>
                        </div>
                        ${showEvents ? this.renderEventsView() : ''}
                        ${showMyEvents ? this.renderMyEventsView() : ''}
                        ${showFavorites ? this.renderFavoritesView() : ''}
                    </div>
                `;
            },
            renderEventsView() {
                const publicEvents = EventManager.getPublicEvents();

                return `
                    <div class="search-container">
                        <input type="text" id="searchInput" class="search-input" placeholder="Buscar eventos..." value="${AppState.ui.searchQuery}">
                        <button class="search-btn" onclick="SearchManager.performSearch()">
                            <i class="fas fa-search"></i>
                        </button>
                    </div>

                    <div class="filter-container">
                        <button class="filter-btn ${!AppState.ui.activeFilters.location ? 'active' : ''}" onclick="SearchManager.clearFilter('location')">
                            Todas as Cidades
                        </button>
                        ${EventManager.getEventCategories().map(category => `
                            <button class="filter-btn ${AppState.ui.activeFilters.category === category ? 'active' : ''}" onclick="SearchManager.setFilter('category', '${category}')">
                                ${category}
                            </button>
                        `).join('')}
                    </div>

                    <div class="events-grid">
                        ${publicEvents.length > 0 ? 
                            TemplateHelpers.loop(publicEvents, event => 
                                EventTemplates.card(event, { showFollowButton: true })
                            ) : 
                            this.renderEmptyState('eventos', 'busca')
                        }
                    </div>
                `;
            },
            renderMyEventsView() {
                const followedEvents = EventManager.getFollowedEvents();

                if (followedEvents.length === 0) {
                    return this.renderEmptyState('eventos seguidos', 'divulgador');
                }
                return `
                    <div class="events-grid">
                        ${TemplateHelpers.loop(followedEvents, event => {
                            const eventTasks = TaskManager.getEventTasks(event.id);

                            return `
                                <div class="event-card" onclick="UI.showEventDetail('${event.id}')">
                                    <img src="${event.image}" alt="${event.name}" class="event-card-image lazy-image" onload="this.classList.add('loaded')">
                                    <div class="event-card-content">
                                        <div class="flex justify-between items-start">
                                            <h3 class="event-card-title">${event.name}</h3>
                                            <span class="bg-green-500 text-white px-2 py-1 rounded text-sm">Seguindo</span>
                                        </div>
                                        <div class="event-card-info">
                                            <div class="event-card-meta">
                                                <i class="fas fa-map-marker-alt"></i>
                                                <span>${event.location}</span>
                                            </div>
                                            <div class="event-card-meta">
                                                <i class="fas fa-calendar-alt"></i>
                                                <span>${FormatHelper.date(event.start_date)}</span>
                                            </div>
                                            <p class="event-card-description">${FormatHelper.truncate(event.description, 100)}</p>
                                            <div class="mt-3">
                                                <span class="bg-blue-900 text-white px-3 py-1 rounded-full text-sm">
                                                    ${eventTasks.length} tarefas dispon√≠veis
                                                </span>
                                            </div>
                                        </div>
                                        <div class="event-card-actions">
                                            <button onclick="UI.showEventDetail('${event.id}')" class="event-card-button follow">
                                                Ver Detalhes
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            `;
                        })}
                    </div>
                `;
            },
            renderFavoritesView() {
                const favoriteEvents = EventManager.getFavoriteEvents();

                if (favoriteEvents.length === 0) {
                    return this.renderEmptyState('eventos favoritos', 'divulgador');
                }
                return `
                    <div class="events-grid">
                        ${TemplateHelpers.loop(favoriteEvents, event => 
                            EventTemplates.card(event, { showFollowButton: true })
                        )}
                    </div>
                `;
            },
            renderEmptyState(type, userType = '') {
                const messages = {
                    eventos: {
                        organizador: {
                            title: 'Nenhum evento criado ainda',
                            description: 'Comece criando seu primeiro evento!',
                            action: 'Criar Primeiro Evento',
                            handler: 'UI.showEventCreateModal()'
                        }
                    },
                    'eventos seguidos': {
                        divulgador: {
                            title: 'Nenhum evento seguido',
                            description: 'Comece seguindo eventos para ver suas tarefas!',
                            action: 'Ver Eventos Dispon√≠veis',
                            handler: 'UI.setPromoterView(\'events\')'
                        }
                    },
                    'eventos favoritos': {
                        divulgador: {
                            title: 'Nenhum evento favoritado',
                            description: 'Adicione eventos aos favoritos para encontr√°-los facilmente!',
                            action: 'Ver Eventos Dispon√≠veis',
                            handler: 'UI.setPromoterView(\'events\')'
                        }
                    },
                    busca: {
                        search: {
                            title: 'Nenhum evento encontrado',
                            description: 'Tente ajustar os filtros ou termos de busca.'
                        }
                    }
                };
                const message = messages[type]?.[userType] || {
                    title: `Nenhum ${type} encontrado`,
                    description: 'Tente novamente mais tarde.'
                };
                return `
                    <div class="empty-state">
                        <div class="empty-state-icon">${type.includes('evento') ? 'üìÖ' : 'üîç'}</div>
                        <h3 class="empty-state-title">${message.title}</h3>
                        <p class="empty-state-description">${message.description}</p>
                        ${message.action ? `
                            <button onclick="${message.handler}" class="empty-state-button">
                                ${message.action}
                            </button>
                        ` : ''}
                    </div>
                `;
            },
            renderProfilePage() {
                const user = AuthManager.getCurrentUser();
                const profile = AppState.userProfiles.get(user.id) || {};
                const activeTab = AppState.ui.profileTab;
                const mainContent = document.getElementById('mainContent');
                mainContent.innerHTML = `
                    <div class="max-w-6xl mx-auto">
                        <div class="bg-white rounded-xl shadow-lg overflow-hidden fade-in">
                            <div class="bg-gradient-to-r from-blue-600 to-blue-800 text-white p-8">
                                <div class="flex items-center gap-6">
                                    <div class="profile-photo-container">
                                        <img src="${profile.profilePicture || 'https://via.placeholder.com/150'}" alt="${profile.name}" class="profile-photo">
                                        <div>
                                            <button onclick="UI.showUploadPhotoModal()" class="btn btn-warning mt-2">
                                                <i class="fas fa-camera"></i> Alterar Foto
                                            </button>
                                        </div>
                                    </div>
                                    <div class="flex-1">
                                        <h1 class="text-3xl font-bold font-['Poppins']">${profile.name || user.name}</h1>
                                        <p class="text-blue-100 text-lg">${profile.title || ''}</p>
                                        <p class="text-blue-200 mt-2">${profile.bio || ''}</p>
                                        <div class="social-links mt-4">
                                            ${Object.entries(profile.socialLinks || {}).map(([platform, url]) => `
                                                <a href="${url}" target="_blank" class="social-link">
                                                    <i class="fab fa-${platform}"></i>
                                                    ${platform}
                                                </a>
                                            `).join('')}
                                            ${Object.keys(profile.socialLinks || {}).length === 0 ? 
                                                '<p class="text-blue-200">Nenhuma rede social adicionada</p>' : ''
                                            }
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="p-8">
                                <div class="flex gap-4 mb-8">
                                    <button onclick="AppState.ui.currentPage = 'dashboard'; Renderer.renderApp();" class="btn btn-outline">
                                        <i class="fas fa-arrow-left"></i> Voltar ao Dashboard
                                    </button>
                                    <button onclick="UI.showEditProfileModal()" class="btn btn-primary">
                                        <i class="fas fa-edit"></i> Editar Perfil
                                    </button>
                                    <button onclick="UI.generateProfilePDF()" class="btn btn-success">
                                        <i class="fas fa-file-pdf"></i> Exportar PDF
                                    </button>
                                </div>

                                <div class="profile-tabs">
                                    <button class="profile-tab ${activeTab === 'personal' ? 'active' : ''}" onclick="UI.setProfileTab('personal')">
                                        <i class="fas fa-user"></i> Dados Pessoais
                                    </button>
                                    <button class="profile-tab ${activeTab === 'address' ? 'active' : ''}" onclick="UI.setProfileTab('address')">
                                        <i class="fas fa-map-marker-alt"></i> Endere√ßo
                                    </button>
                                    <button class="profile-tab ${activeTab === 'social' ? 'active' : ''}" onclick="UI.setProfileTab('social')">
                                        <i class="fas fa-share-alt"></i> Redes Sociais
                                    </button>
                                    <button class="profile-tab ${activeTab === 'medical' ? 'active' : ''}" onclick="UI.setProfileTab('medical')">
                                        <i class="fas fa-heartbeat"></i> Primeiros Socorros
                                    </button>
                                </div>

                                <div id="profileContent">
                                    ${this.renderProfileSection(activeTab, profile)}
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            },
            renderProfileSection(section, profile) {
                switch(section) {
                    case 'personal':
                        return this.renderPersonalInfo(profile);
                    case 'address':
                        return this.renderAddressInfo(profile);
                    case 'social':
                        return this.renderSocialInfo(profile);
                    case 'medical':
                        return this.renderMedicalInfo(profile);
                    default:
                        return this.renderPersonalInfo(profile);
                }
            },
            renderPersonalInfo(profile) {
                const personalInfo = profile.personalInfo || {};

                return `
                    <div class="profile-section active">
                        <h3 class="text-2xl font-bold text-gray-800 mb-6 font-['Poppins']">Informa√ß√µes Pessoais</h3>
                        <div class="profile-grid">
                            <div class="profile-field">
                                <label>Nome Completo</label>
                                <div class="p-2 bg-gray-50 rounded">${personalInfo.fullName || 'N√£o informado'}</div>
                            </div>
                            <div class="profile-field">
                                <label>Data de Nascimento</label>
                                <div class="p-2 bg-gray-50 rounded">${personalInfo.birthDate ? FormatHelper.date(personalInfo.birthDate) : 'N√£o informado'}</div>
                            </div>
                            <div class="profile-field">
                                <label>CPF</label>
                                <div class="p-2 bg-gray-50 rounded">${personalInfo.cpf || 'N√£o informado'}</div>
                            </div>
                            <div class="profile-field">
                                <label>RG</label>
                                <div class="p-2 bg-gray-50 rounded">${personalInfo.rg || 'N√£o informado'}</div>
                            </div>
                            <div class="profile-field">
                                <label>G√™nero</label>
                                <div class="p-2 bg-gray-50 rounded">${personalInfo.gender || 'N√£o informado'}</div>
                            </div>
                            <div class="profile-field">
                                <label>Estado Civil</label>
                                <div class="p-2 bg-gray-50 rounded">${personalInfo.maritalStatus || 'N√£o informado'}</div>
                            </div>
                            <div class="profile-field">
                                <label>Email</label>
                                <div class="p-2 bg-gray-50 rounded">${profile.email || 'N√£o informado'}</div>
                            </div>
                            <div class="profile-field">
                                <label>Telefone</label>
                                <div class="p-2 bg-gray-50 rounded">${profile.phone || 'N√£o informado'}</div>
                            </div>
                            <div class="profile-field">
                                <label>Tipo de Usu√°rio</label>
                                <div class="p-2 bg-gray-50 rounded">${AuthManager.getCurrentUser().type === Constants.USER_TYPES.ORGANIZER ? 'Organizador' : 'Divulgador'}</div>
                            </div>
                        </div>
                    </div>
                `;
            },
            renderAddressInfo(profile) {
                const address = profile.address || {};

                return `
                    <div class="profile-section active">
                        <h3 class="text-2xl font-bold text-gray-800 mb-6 font-['Poppins']">Informa√ß√µes de Endere√ßo</h3>
                        <div class="profile-grid">
                            <div class="profile-field">
                                <label>CEP</label>
                                <div class="p-2 bg-gray-50 rounded">${address.cep || 'N√£o informado'}</div>
                            </div>
                            <div class="profile-field">
                                <label>Logradouro</label>
                                <div class="p-2 bg-gray-50 rounded">${address.street || 'N√£o informado'}</div>
                            </div>
                            <div class="profile-field">
                                <label>N√∫mero</label>
                                <div class="p-2 bg-gray-50 rounded">${address.number || 'N√£o informado'}</div>
                            </div>
                            <div class="profile-field">
                                <label>Complemento</label>
                                <div class="p-2 bg-gray-50 rounded">${address.complement || 'N√£o informado'}</div>
                            </div>
                            <div class="profile-field">
                                <label>Bairro</label>
                                <div class="p-2 bg-gray-50 rounded">${address.neighborhood || 'N√£o informado'}</div>
                            </div>
                            <div class="profile-field">
                                <label>Cidade</label>
                                <div class="p-2 bg-gray-50 rounded">${address.city || 'N√£o informado'}</div>
                            </div>
                            <div class="profile-field">
                                <label>Estado</label>
                                <div class="p-2 bg-gray-50 rounded">${address.state || 'N√£o informado'}</div>
                            </div>
                            <div class="profile-field">
                                <label>Pa√≠s</label>
                                <div class="p-2 bg-gray-50 rounded">${address.country || 'N√£o informado'}</div>
                            </div>
                        </div>
                    </div>
                `;
            },
            renderSocialInfo(profile) {
                const socialLinks = profile.socialLinks || {};
                const platforms = [
                    { key: 'instagram', name: 'Instagram', color: 'text-pink-600' },
                    { key: 'facebook', name: 'Facebook', color: 'text-blue-600' },
                    { key: 'tiktok', name: 'TikTok', color: 'text-black' },
                    { key: 'linkedin', name: 'LinkedIn', color: 'text-blue-700' },
                    { key: 'youtube', name: 'YouTube', color: 'text-red-600' },
                    { key: 'twitter', name: 'Twitter', color: 'text-blue-400' },
                    { key: 'website', name: 'Site', color: 'text-green-600' }
                ];
                return `
                    <div class="profile-section active">
                        <h3 class="text-2xl font-bold text-gray-800 mb-6 font-['Poppins']">Redes Sociais e Contato</h3>

                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                            ${platforms.map(platform => {
                                const url = socialLinks[platform.key];
                                return `
                                    <div class="flex items-center justify-between p-4 bg-gray-50 rounded-lg border border-gray-200">
                                        <div class="flex items-center gap-3">
                                            <i class="${SocialProfileManager.getSocialIcon(platform.key)} text-2xl ${platform.color}"></i>
                                            <div>
                                                <h4 class="font-semibold text-gray-800">${platform.name}</h4>
                                                ${url ? 
                                                    `<a href="${url}" target="_blank" class="text-blue-600 hover:underline text-sm break-all">${url.replace(/^https?:\/\//, '')}</a>` :
                                                    '<span class="text-gray-500 text-sm">N√£o informado</span>'
                                                }
                                            </div>
                                        </div>
                                        ${url ? `
                                            <a href="${url}" target="_blank" class="btn btn-outline text-sm px-3 py-1">
                                                <i class="fas fa-external-link-alt"></i>
                                            </a>
                                        ` : `
                                            <button onclick="UI.showAddSocialLinkModal('${platform.key}')" class="btn btn-primary text-sm px-3 py-1">
                                                <i class="fas fa-plus"></i>
                                            </button>
                                        `}
                                    </div>
                                `;
                            }).join('')}
                        </div>

                        <div class="bg-blue-50 border border-blue-200 rounded-lg p-4">
                            <h4 class="font-semibold text-blue-900 mb-2">üìä Estat√≠sticas do Perfil</h4>
                            <div class="grid grid-cols-2 md:grid-cols-4 gap-4 text-center">
                                <div class="bg-white rounded-lg p-3 border">
                                    <div class="text-2xl font-bold text-blue-900">${AppState.followedEventIds.size}</div>
                                    <div class="text-sm text-gray-600">Eventos Seguindo</div>
                                </div>
                                <div class="bg-white rounded-lg p-3 border">
                                    <div class="text-2xl font-bold text-green-900">${TaskManager.getUserSubmissions(AuthManager.getCurrentUser().id).length}</div>
                                    <div class="text-sm text-gray-600">Tarefas Conclu√≠das</div>
                                </div>
                                <div class="bg-white rounded-lg p-3 border">
                                    <div class="text-2xl font-bold text-purple-900">${AppState.favoriteEventIds.size}</div>
                                    <div class="text-sm text-gray-600">Favoritos</div>
                                </div>
                                <div class="bg-white rounded-lg p-3 border">
                                    <div class="text-2xl font-bold text-orange-900">${Object.keys(socialLinks).length}</div>
                                    <div class="text-sm text-gray-600">Redes Conectadas</div>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            },
            renderMedicalInfo(profile) {
                const medicalInfo = profile.medicalInfo || {};
                const emergencyContact = medicalInfo.emergencyContact || {};

                return `
                    <div class="profile-section active">
                        <h3 class="text-2xl font-bold text-gray-800 mb-6 font-['Poppins']">Informa√ß√µes para Primeiros Socorros</h3>
                        <div class="medical-card">
                            <h4><i class="fas fa-heartbeat"></i> Ficha M√©dica</h4>
                            <div class="medical-info">
                                <div class="medical-field">
                                    <strong>Tipo Sangu√≠neo</strong>
                                    <span>${medicalInfo.bloodType || 'N√£o informado'}</span>
                                </div>
                                <div class="medical-field">
                                    <strong>Alergias</strong>
                                    <span>${medicalInfo.allergies || 'Nenhuma'}</span>
                                </div>
                                <div class="medical-field">
                                    <strong>Medicamentos em Uso</strong>
                                    <span>${medicalInfo.medications || 'Nenhum'}</span>
                                </div>
                                <div class="medical-field">
                                    <strong>Doen√ßas Pr√©-existentes</strong>
                                    <span>${medicalInfo.conditions || 'Nenhuma'}</span>
                                </div>
                                <div class="medical-field">
                                    <strong>Contato de Emerg√™ncia</strong>
                                    <span>${emergencyContact.name || 'N√£o informado'} - ${emergencyContact.phone || ''} (${emergencyContact.relationship || ''})</span>
                                </div>
                                <div class="medical-field">
                                    <strong>Plano de Sa√∫de</strong>
                                    <span>${medicalInfo.healthInsurance || 'N√£o informado'}</span>
                                </div>
                                <div class="medical-field">
                                    <strong>Observa√ß√µes Adicionais</strong>
                                    <span>${medicalInfo.additionalNotes || 'Nenhuma'}</span>
                                </div>
                            </div>
                        </div>
                        <div class="mt-4">
                            <button onclick="UI.generateMedicalCard()" class="btn btn-danger">
                                <i class="fas fa-file-medical"></i> Gerar Ficha M√©dica
                            </button>
                        </div>
                    </div>
                `;
            },
            initializeLazyLoading() {
                if ('IntersectionObserver' in window) {
                    const imageObserver = new IntersectionObserver((entries, observer) => {
                        entries.forEach(entry => {
                            if (entry.isIntersecting) {
                                const img = entry.target;
                                if (img.dataset.src) {
                                    img.src = img.dataset.src;
                                }
                                img.classList.add('loaded');
                                imageObserver.unobserve(img);
                            }
                        });
                    });
                    document.querySelectorAll('.lazy-image').forEach(img => {
                        if (!img.classList.contains('loaded')) {
                            imageObserver.observe(img);
                        }
                    });
                } else {
                    document.querySelectorAll('.lazy-image').forEach(img => {
                        img.classList.add('loaded');
                    });
                }
            }
        };
        // === SISTEMA DE UI ORIGINAL COMPLETO ===
        const UI = {
            showLoginModal() {
                const html = `
                    <div class="fixed inset-0 bg-black/50 flex items-center justify-center p-4 z-50">
                        <div class="bg-white rounded-xl p-8 max-w-md w-full">
                            <div class="flex justify-between items-center mb-6">
                                <h3 class="text-2xl font-bold text-blue-900 font-['Poppins']">Entrar</h3>
                                <button onclick="ModalHelper.close()" class="text-gray-500 hover:text-gray-700">
                                    <i class="fas fa-times text-xl"></i>
                                </button>
                            </div>
                            <form id="loginForm">
                                <div class="space-y-4">
                                    <div>
                                        <label class="block text-gray-700 font-semibold mb-2">Email</label>
                                        <input type="email" name="email" required class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:border-blue-900 focus:outline-none" placeholder="seu@email.com">
                                    </div>
                                    <div>
                                        <label class="block text-gray-700 font-semibold mb-2">Senha</label>
                                        <input type="password" name="password" required class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:border-blue-900 focus:outline-none" placeholder="Sua senha">
                                    </div>
                                </div>
                                <div class="flex gap-4 mt-6">
                                    <button type="button" onclick="ModalHelper.close()" class="flex-1 btn btn-secondary">
                                        Cancelar
                                    </button>
                                    <button type="submit" class="flex-1 btn btn-primary">
                                        Entrar
                                    </button>
                                </div>
                                <div class="text-center mt-4">
                                    <p class="text-gray-600">
                                        Ainda n√£o tem conta?
                                        <button type="button" onclick="ModalHelper.close(); UI.showRegisterModal();" class="text-blue-900 hover:underline font-semibold">
                                            Cadastre-se aqui
                                        </button>
                                    </p>
                                    <p class="text-gray-600 mt-2">
                                        Esqueceu sua senha?
                                        <button type="button" onclick="ModalHelper.close(); UI.showPasswordRecoveryModal();" class="text-blue-900 hover:underline font-semibold">
                                            Recuperar senha
                                        </button>
                                    </p>
                                </div>
                                <div class="mt-6 p-4 bg-gray-100 rounded-lg">
                                    <p class="text-sm text-gray-600 mb-2">Contas de demonstra√ß√£o:</p>
                                    <div class="text-xs space-y-1">
                                        <div><strong>Organizador:</strong> organizador@demo.com / 123456</div>
                                        <div><strong>Divulgador:</strong> divulgador@demo.com / 123456</div>
                                    </div>
                                </div>
                            </form>
                        </div>
                    </div>
                `;
                const modal = ModalHelper.open(html);
                if (!modal) return;
                const form = modal.querySelector('#loginForm');
                form.addEventListener('submit', (e) => {
                    e.preventDefault();
                    const formData = new FormData(e.target);
                    try {
                        AuthManager.login(formData.get('email'), formData.get('password'));
                        ModalHelper.close();
                        Renderer.renderApp();
                    } catch (error) {
                        showAlert(error.message, 'error');
                    }
                });
            },
            showPasswordRecoveryModal() {
                const html = `
                    <div class="fixed inset-0 bg-black/50 flex items-center justify-center p-4 z-50">
                        <div class="bg-white rounded-xl p-8 max-w-md w-full">
                            <div class="flex justify-between items-center mb-6">
                                <h3 class="text-2xl font-bold text-blue-900 font-['Poppins']">Recuperar Senha</h3>
                                <button onclick="ModalHelper.close()" class="text-gray-500 hover:text-gray-700">
                                    <i class="fas fa-times text-xl"></i>
                                </button>
                            </div>
                            <form id="recoveryForm">
                                <div class="space-y-4">
                                    <div>
                                        <label class="block text-gray-700 font-semibold mb-2">Email</label>
                                        <input type="email" name="email" required class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:border-blue-900 focus:outline-none" placeholder="seu@email.com">
                                        <p class="text-gray-500 text-sm mt-1">Enviaremos um link para redefinir sua senha</p>
                                    </div>
                                </div>
                                <div class="flex gap-4 mt-6">
                                    <button type="button" onclick="ModalHelper.close()" class="flex-1 btn btn-secondary">
                                        Cancelar
                                    </button>
                                    <button type="submit" class="flex-1 btn btn-warning">
                                        Enviar Link
                                    </button>
                                </div>
                                <div class="text-center mt-4">
                                    <p class="text-gray-600">
                                        Lembrou sua senha?
                                        <button type="button" onclick="ModalHelper.close(); UI.showLoginModal();" class="text-blue-900 hover:underline font-semibold">
                                            Fazer login
                                        </button>
                                    </p>
                                </div>
                            </form>
                        </div>
                    </div>
                `;
                const modal = ModalHelper.open(html);
                if (!modal) return;
                const form = modal.querySelector('#recoveryForm');
                form.addEventListener('submit', async (e) => {
                    e.preventDefault();
                    const formData = new FormData(e.target);
                    const email = formData.get('email');

                    try {
                        const userExists = Array.from(AuthManager.users.values()).some(u => u.email === email);
                        if (!userExists) {
                            throw new Error('Email n√£o encontrado em nosso sistema.');
                        }

                        showAlert('Enviando email de recupera√ß√£o...', 'info');

                        await PasswordRecoveryManager.sendResetEmail(email);

                        ModalHelper.close();
                        showAlert('Email de recupera√ß√£o enviado! Verifique sua caixa de entrada.', 'success');
                    } catch (error) {
                        showAlert(error.message, 'error');
                    }
                });
            },
            showResetPasswordModal(token) {
                const html = `
                    <div class="fixed inset-0 bg-black/50 flex items-center justify-center p-4 z-50">
                        <div class="bg-white rounded-xl p-8 max-w-md w-full">
                            <div class="flex justify-between items-center mb-6">
                                <h3 class="text-2xl font-bold text-blue-900 font-['Poppins']">Redefinir Senha</h3>
                                <button onclick="ModalHelper.close()" class="text-gray-500 hover:text-gray-700">
                                    <i class="fas fa-times text-xl"></i>
                                </button>
                            </div>
                            <form id="resetPasswordForm">
                                <input type="hidden" name="token" value="${token}">
                                <div class="space-y-4">
                                    <div>
                                        <label class="block text-gray-700 font-semibold mb-2">Nova Senha</label>
                                        <input type="password" name="newPassword" required minlength="6" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:border-blue-900 focus:outline-none" placeholder="M√≠nimo 6 caracteres">
                                    </div>
                                    <div>
                                        <label class="block text-gray-700 font-semibold mb-2">Confirmar Nova Senha</label>
                                        <input type="password" name="confirmPassword" required minlength="6" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:border-blue-900 focus:outline-none" placeholder="Digite a senha novamente">
                                    </div>
                                </div>
                                <div class="flex gap-4 mt-6">
                                    <button type="button" onclick="ModalHelper.close()" class="flex-1 btn btn-secondary">
                                        Cancelar
                                    </button>
                                    <button type="submit" class="flex-1 btn btn-success">
                                        Redefinir Senha
                                    </button>
                                </div>
                            </form>
                        </div>
                    </div>
                `;
                const modal = ModalHelper.open(html);
                if (!modal) return;
                const form = modal.querySelector('#resetPasswordForm');
                form.addEventListener('submit', (e) => {
                    e.preventDefault();
                    const formData = new FormData(e.target);
                    const token = formData.get('token');
                    const newPassword = formData.get('newPassword');
                    const confirmPassword = formData.get('confirmPassword');

                    try {
                        if (newPassword !== confirmPassword) {
                            throw new Error('As senhas n√£o coincidem.');
                        }

                        PasswordRecoveryManager.resetPassword(token, newPassword);

                        ModalHelper.close();
                        showAlert('Senha redefinida com sucesso! Fa√ßa login com sua nova senha.', 'success');
                        UI.showLoginModal();
                    } catch (error) {
                        showAlert(error.message, 'error');
                    }
                });
            },
            showRegisterModal(userType = null) {
                const html = `
                    <div class="fixed inset-0 bg-black/50 flex items-center justify-center p-4 z-50">
                        <div class="bg-white rounded-xl p-8 max-w-md w-full">
                            <div class="flex justify-between items-center mb-6">
                                <h3 class="text-2xl font-bold text-blue-900 font-['Poppins']">Criar Conta</h3>
                                <button onclick="ModalHelper.close()" class="text-gray-500 hover:text-gray-700">
                                    <i class="fas fa-times text-xl"></i>
                                </button>
                            </div>
                            <form id="registerForm">
                                <div class="space-y-4">
                                    <div>
                                        <label class="block text-gray-700 font-semibold mb-2">Tipo de Conta</label>
                                        <div class="grid grid-cols-2 gap-3">
                                            <label class="flex items-center p-3 border-2 rounded-lg cursor-pointer hover:bg-gray-50 ${userType === Constants.USER_TYPES.ORGANIZER ? 'border-blue-900 bg-blue-50' : 'border-gray-300'}">
                                                <input type="radio" name="userType" value="${Constants.USER_TYPES.ORGANIZER}" ${userType === Constants.USER_TYPES.ORGANIZER ? 'checked' : ''} required class="mr-3">
                                                <div>
                                                    <div class="font-semibold text-blue-900">Organizador</div>
                                                    <div class="text-xs text-gray-600">Criar eventos</div>
                                                </div>
                                            </label>
                                            <label class="flex items-center p-3 border-2 rounded-lg cursor-pointer hover:bg-gray-50 ${userType === Constants.USER_TYPES.PROMOTER ? 'border-blue-900 bg-blue-50' : 'border-gray-300'}">
                                                <input type="radio" name="userType" value="${Constants.USER_TYPES.PROMOTER}" ${userType === Constants.USER_TYPES.PROMOTER ? 'checked' : ''} required class="mr-3">
                                                <div>
                                                    <div class="font-semibold text-blue-900">Divulgador</div>
                                                    <div class="text-xs text-gray-600">Divulgar eventos</div>
                                                </div>
                                            </label>
                                        </div>
                                    </div>
                                    <div>
                                        <label class="block text-gray-700 font-semibold mb-2">Nome Completo</label>
                                        <input type="text" name="name" required class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:border-blue-900 focus:outline-none" placeholder="Seu nome completo">
                                    </div>
                                    <div>
                                        <label class="block text-gray-700 font-semibold mb-2">Email</label>
                                        <input type="email" name="email" required class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:border-blue-900 focus:outline-none" placeholder="seu@email.com">
                                    </div>
                                    <div>
                                        <label class="block text-gray-700 font-semibold mb-2">Senha</label>
                                        <input type="password" name="password" required minlength="6" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:border-blue-900 focus:outline-none" placeholder="M√≠nimo 6 caracteres">
                                    </div>
                                </div>
                                <div class="flex gap-4 mt-6">
                                    <button type="button" onclick="ModalHelper.close()" class="flex-1 btn btn-secondary">
                                        Cancelar
                                    </button>
                                    <button type="submit" class="flex-1 btn btn-warning">
                                        Cadastrar
                                    </button>
                                </div>
                            </form>
                        </div>
                    </div>
                `;
                const modal = ModalHelper.open(html);
                if (!modal) return;
                const form = modal.querySelector('#registerForm');
                form.addEventListener('submit', (e) => {
                    e.preventDefault();
                    const formData = new FormData(e.target);
                    try {
                        AuthManager.register({
                            name: formData.get('name'),
                            email: formData.get('email'),
                            password: formData.get('password'),
                            type: formData.get('userType')
                        });
                        ModalHelper.close();
                        Renderer.renderApp();
                    } catch (error) {
                        showAlert(error.message, 'error');
                    }
                });
            },
            showEventCreateModal() {
                const html = `
                    <div class="fixed inset-0 bg-black/50 flex items-center justify-center p-4 z-50">
                        <div class="bg-white rounded-xl p-8 max-w-2xl w-full max-h-[90vh] overflow-y-auto">
                            <div class="flex justify-between items-center mb-6">
                                <h3 class="text-2xl font-bold text-blue-900 font-['Poppins']">Criar Novo Evento</h3>
                                <button onclick="ModalHelper.close()" class="text-gray-500 hover:text-gray-700">
                                    <i class="fas fa-times text-xl"></i>
                                </button>
                            </div>
                            <form id="createEventForm">
                                <div class="space-y-4">
                                    <div>
                                        <label class="block text-gray-700 font-semibold mb-2">Nome do Evento</label>
                                        <input type="text" name="name" required class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:border-blue-900 focus:outline-none" placeholder="Ex: Festival de Ver√£o">
                                    </div>
                                    <div>
                                        <label class="block text-gray-700 font-semibold mb-2">Local</label>
                                        <input type="text" name="location" required class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:border-blue-900 focus:outline-none" placeholder="Cidade, Estado">
                                    </div>
                                    <div class="grid grid-cols-2 gap-4">
                                        <div>
                                            <label class="block text-gray-700 font-semibold mb-2">Data de In√≠cio</label>
                                            <input type="date" name="startDate" required class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:border-blue-900 focus:outline-none">
                                        </div>
                                        <div>
                                            <label class="block text-gray-700 font-semibold mb-2">Data de Fim</label>
                                            <input type="date" name="endDate" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:border-blue-900 focus:outline-none">
                                        </div>
                                    </div>
                                    <div>
                                        <label class="block text-gray-700 font-semibold mb-2">Categoria</label>
                                        <select name="category" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:border-blue-900 focus:outline-none">
                                            <option value="">Selecione uma categoria</option>
                                            <option value="M√∫sica">M√∫sica</option>
                                            <option value="Educa√ß√£o">Educa√ß√£o</option>
                                            <option value="Artesanato">Artesanato</option>
                                            <option value="Esportes">Esportes</option>
                                            <option value="Gastronomia">Gastronomia</option>
                                            <option value="Tecnologia">Tecnologia</option>
                                        </select>
                                    </div>
                                    <div>
                                        <label class="block text-gray-700 font-semibold mb-2">Descri√ß√£o</label>
                                        <textarea name="description" rows="3" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:border-blue-900 focus:outline-none" placeholder="Descreva seu evento..."></textarea>
                                    </div>
                                    <div>
                                        <label class="block text-gray-700 font-semibold mb-2">Imagem do Evento</label>
                                        <input type="file" id="eventImageInput" accept="image/*" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:border-blue-900 focus:outline-none">
                                        <div id="eventImagePreview" class="mt-2"></div>
                                    </div>

                                    <!-- Se√ß√£o de Ingressos -->
                                    <div class="border-t pt-4 mt-4">
                                        <h4 class="text-lg font-semibold text-blue-900 mb-3">Ingressos e Lotes</h4>
                                        <div id="ticketFields">
                                            <div class="ticket-field">
                                                <div class="grid grid-cols-2 gap-4 mb-3">
                                                    <div>
                                                        <label class="block text-gray-700 font-semibold mb-2">Nome do Lote</label>
                                                        <input type="text" name="ticketName[]" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:border-blue-900 focus:outline-none" placeholder="Ex: Lote Promocional" required>
                                                    </div>
                                                    <div>
                                                        <label class="block text-gray-700 font-semibold mb-2">Pre√ßo (R$)</label>
                                                        <input type="number" name="ticketPrice[]" min="0" step="0.01" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:border-blue-900 focus:outline-none" placeholder="0.00" required>
                                                    </div>
                                                </div>
                                                <div class="flex justify-between items-center">
                                                    <div>
                                                        <label class="block text-gray-700 font-semibold mb-2">Quantidade</label>
                                                        <input type="number" name="ticketQuantity[]" min="1" class="w-32 px-4 py-3 border border-gray-300 rounded-lg focus:border-blue-900 focus:outline-none" placeholder="100" required>
                                                    </div>
                                                    <button type="button" onclick="UI.removeTicketField(this)" class="remove-ticket-btn">
                                                        Remover
                                                    </button>
                                                </div>
                                            </div>
                                        </div>
                                        <button type="button" onclick="UI.addTicketField()" class="bg-green-500 text-white px-4 py-2 rounded-lg hover:bg-green-600 transition-colors">
                                            + Adicionar Lote
                                        </button>
                                    </div>
                                </div>
                                <div class="flex gap-4 mt-6">
                                    <button type="button" onclick="ModalHelper.close()" class="flex-1 btn btn-secondary">
                                        Cancelar
                                    </button>
                                    <button type="submit" class="flex-1 btn btn-warning">
                                        Criar Evento
                                    </button>
                                </div>
                            </form>
                        </div>
                    </div>
                `;
                const modal = ModalHelper.open(html);
                if (!modal) return;
                const imageInput = modal.querySelector('#eventImageInput');
                imageInput.addEventListener('change', (e) => {
                    ImageUploader.previewImage(e.target, 'eventImagePreview');
                });
                const form = modal.querySelector('#createEventForm');
                form.addEventListener('submit', async (e) => {
                    e.preventDefault();
                    const formData = new FormData(e.target);
                    const imageFile = imageInput.files[0];

                    const imageUrl = await ImageUploader.handleImageUpload(imageFile, Constants.DEFAULT_IMAGES.EVENT);

                    const ticketNames = formData.getAll('ticketName[]');
                    const ticketPrices = formData.getAll('ticketPrice[]');
                    const ticketQuantities = formData.getAll('ticketQuantity[]');

                    const tickets = ticketNames.map((name, index) => ({
                        id: 'ticket_' + Date.now() + '_' + index,
                        name: name,
                        price: parseFloat(ticketPrices[index]),
                        quantity: parseInt(ticketQuantities[index])
                    }));

                    const newEvent = EventManager.createEvent({
                        name: formData.get('name'),
                        location: formData.get('location'),
                        start_date: formData.get('startDate'),
                        end_date: formData.get('endDate') || formData.get('startDate'),
                        category: formData.get('category'),
                        description: formData.get('description'),
                        image: imageUrl,
                        tickets: tickets
                    });

                    EventManager.addEventImage(newEvent.id, imageUrl);

                    showAlert('Evento criado com sucesso!', 'success');
                    ModalHelper.close();
                    Renderer.renderApp();
                });
            },
            showEventManagementModal(eventId) {
                const event = EventManager.getEventById(eventId);
                if (!event) return;
                const eventTasks = TaskManager.getEventTasks(eventId);
                const taskSubmissions = eventTasks.map(task => {
                    const submissions = TaskManager.getTaskSubmissions(task.id);
                    return { task, submissions };
                });
                const eventImages = EventManager.getEventImages(eventId);
                const html = `
                    <div class="fixed inset-0 bg-black/50 flex items-center justify-center p-4 z-50">
                        <div class="bg-white rounded-xl p-8 max-w-4xl w-full max-h-[90vh] overflow-y-auto">
                            <div class="flex justify-between items-center mb-6">
                                <h3 class="text-2xl font-bold text-blue-900 font-['Poppins']">Gerenciar Evento: ${event.name}</h3>
                                <button onclick="ModalHelper.close()" class="text-gray-500 hover:text-gray-700">
                                    <i class="fas fa-times text-xl"></i>
                                </button>
                            </div>

                            <!-- Se√ß√£o de Imagens do Evento -->
                            <div class="event-images-section">
                                <div class="event-images-header">
                                    <h4 class="event-images-title">
                                        <i class="fas fa-images"></i> Imagens do Evento
                                    </h4>
                                    <button class="add-image-btn" onclick="UI.showAddImageModal('${eventId}')">
                                        <i class="fas fa-plus"></i> Adicionar Imagem
                                    </button>
                                </div>
                                ${eventImages.length > 0 ? `
                                    <div id="eventCarouselContainer"></div>
                                    <div class="mt-4 text-center">
                                        <p class="text-gray-600 text-sm">Clique no bot√£o de download <i class="fas fa-download"></i> em qualquer imagem para baix√°-la</p>
                                    </div>
                                ` : `
                                    <div class="text-center py-8">
                                        <i class="fas fa-images text-4xl text-gray-400 mb-4"></i>
                                        <p class="text-gray-600">Nenhuma imagem adicionada ainda.</p>
                                        <p class="text-gray-500 text-sm mt-2">Adicione imagens para criar um carrossel estilo reels.</p>
                                    </div>
                                `}
                            </div>

                            <div class="mb-8">
                                <h4 class="text-lg font-semibold mb-4">Tarefas do Evento</h4>
                                <div class="space-y-4">
                                    ${taskSubmissions.map(({ task, submissions }) => `
                                        <div class="border rounded-lg p-4">
                                            <div class="flex justify-between items-start mb-2">
                                                <h5 class="font-semibold">${task.title}</h5>
                                                <span class="bg-blue-100 text-blue-800 px-2 py-1 rounded text-sm">
                                                    ${submissions.length} envios
                                                </span>
                                            </div>
                                            <p class="text-gray-600 text-sm mb-3">${task.description}</p>
                                            ${submissions.length > 0 ? `
                                                <div class="mt-3">
                                                    <h6 class="font-medium mb-2">Submiss√µes:</h6>
                                                    <div class="space-y-2">
                                                        ${submissions.map(submission => `
                                                            <div class="flex justify-between items-center p-2 bg-gray-50 rounded">
                                                                <div>
                                                                    <span class="font-medium">${submission.user_name}</span>
                                                                    <a href="${submission.link}" target="_blank" class="text-blue-600 hover:underline ml-2">Ver publica√ß√£o</a>
                                                                </div>
                                                                <span class="text-sm text-gray-500">${FormatHelper.timeAgo(submission.submitted_at)}</span>
                                                            </div>
                                                        `).join('')}
                                                    </div>
                                                </div>
                                            ` : '<p class="text-gray-500 text-sm">Nenhuma submiss√£o ainda.</p>'}
                                        </div>
                                    `).join('')}
                                </div>
                            </div>

                            <div class="flex gap-4">
                                <button onclick="UI.showTaskCreateModal('${eventId}')" class="flex-1 btn btn-success">
                                    + Adicionar Tarefa
                                </button>
                                <button onclick="ModalHelper.close()" class="flex-1 btn btn-secondary">
                                    Fechar
                                </button>
                            </div>
                        </div>
                    </div>
                `;
                const modal = ModalHelper.open(html);

                if (eventImages.length > 0) {
                    setTimeout(() => {
                        CarouselManager.initCarousel('eventCarouselContainer', eventImages);
                    }, 100);
                }
            },
            showAddImageModal(eventId) {
                const html = `
                    <div class="fixed inset-0 bg-black/50 flex items-center justify-center p-4 z-50">
                        <div class="bg-white rounded-xl p-8 max-w-md w-full max-h-[90vh] overflow-y-auto">
                            <div class="flex justify-between items-center mb-6">
                                <h3 class="text-2xl font-bold text-blue-900 font-['Poppins']">Adicionar Imagem ao Evento</h3>
                                <button onclick="ModalHelper.close()" class="text-gray-500 hover:text-gray-700">
                                    <i class="fas fa-times text-xl"></i>
                                </button>
                            </div>
                            <form id="addImageForm">
                                <div class="space-y-4">
                                    <div>
                                        <label class="block text-gray-700 font-semibold mb-2">Imagem do Evento</label>
                                        <input type="file" id="eventImageInput" accept="image/*" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:border-blue-900 focus:outline-none" required>
                                        <div id="eventImagePreview" class="mt-2"></div>
                                    </div>
                                </div>
                                <div class="flex gap-4 mt-6">
                                    <button type="button" onclick="ModalHelper.close()" class="flex-1 btn btn-secondary">
                                        Cancelar
                                    </button>
                                    <button type="submit" class="flex-1 btn btn-warning">
                                        Adicionar Imagem
                                    </button>
                                </div>
                            </form>
                        </div>
                    </div>
                `;
                const modal = ModalHelper.open(html);
                if (!modal) return;
                const imageInput = modal.querySelector('#eventImageInput');
                imageInput.addEventListener('change', (e) => {
                    ImageUploader.previewImage(e.target, 'eventImagePreview');
                });
                const form = modal.querySelector('#addImageForm');
                form.addEventListener('submit', async (e) => {
                    e.preventDefault();
                    const imageFile = imageInput.files[0];

                    if (!imageFile) {
                        showAlert('Por favor, selecione uma imagem', 'warning');
                        return;
                    }

                    const imageUrl = await ImageUploader.handleImageUpload(imageFile, Constants.DEFAULT_IMAGES.EVENT);

                    EventManager.addEventImage(eventId, imageUrl);

                    showAlert('Imagem adicionada com sucesso!', 'success');
                    ModalHelper.close();
                    UI.showEventManagementModal(eventId);
                });
            },
            showTaskCreateModal(eventId) {
                const html = `
                    <div class="fixed inset-0 bg-black/50 flex items-center justify-center p-4 z-50">
                        <div class="bg-white rounded-xl p-8 max-w-md w-full max-h-[90vh] overflow-y-auto">
                            <div class="flex justify-between items-center mb-6">
                                <h3 class="text-2xl font-bold text-blue-900 font-['Poppins']">Criar Nova Tarefa</h3>
                                <button onclick="ModalHelper.close()" class="text-gray-500 hover:text-gray-700">
                                    <i class="fas fa-times text-xl"></i>
                                </button>
                            </div>
                            <form id="createTaskForm">
                                <input type="hidden" name="eventId" value="${eventId}">
                                <div class="space-y-4">
                                    <div>
                                        <label class="block text-gray-700 font-semibold mb-2">T√≠tulo da Tarefa</label>
                                        <input type="text" name="title" required class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:border-blue-900 focus:outline-none" placeholder="Ex: Post no Instagram">
                                    </div>
                                    <div>
                                        <label class="block text-gray-700 font-semibold mb-2">Descri√ß√£o</label>
                                        <textarea name="description" rows="3" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:border-blue-900 focus:outline-none" placeholder="Descreva a tarefa..."></textarea>
                                    </div>
                                    <div class="grid grid-cols-2 gap-4">
                                        <div>
                                            <label class="block text-gray-700 font-semibold mb-2">Rede Social</label>
                                            <select name="socialMedia" required class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:border-blue-900 focus:outline-none">
                                                <option value="instagram">Instagram</option>
                                                <option value="facebook">Facebook</option>
                                                <option value="tiktok">TikTok</option>
                                                <option value="twitter">Twitter</option>
                                            </select>
                                        </div>
                                        <div>
                                            <label class="block text-gray-700 font-semibold mb-2">Tipo de Conte√∫do</label>
                                            <select name="taskType" required class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:border-blue-900 focus:outline-none">
                                                <option value="feed">Feed</option>
                                                <option value="story">Story</option>
                                                <option value="reel">Reel</option>
                                                <option value="post">Post</option>
                                                <option value="video">V√≠deo</option>
                                            </select>
                                        </div>
                                    </div>
                                    <div>
                                        <label class="block text-gray-700 font-semibold mb-2">Prazo</label>
                                        <input type="date" name="deadline" required class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:border-blue-900 focus:outline-none">
                                    </div>
                                </div>
                                <div class="flex gap-4 mt-6">
                                    <button type="button" onclick="ModalHelper.close()" class="flex-1 btn btn-secondary">
                                        Cancelar
                                    </button>
                                    <button type="submit" class="flex-1 btn btn-warning">
                                        Criar Tarefa
                                    </button>
                                </div>
                            </form>
                        </div>
                    </div>
                `;
                const modal = ModalHelper.open(html);
                if (!modal) return;
                const form = modal.querySelector('#createTaskForm');
                form.addEventListener('submit', async (e) => {
                    e.preventDefault();
                    const formData = new FormData(e.target);

                    const socialMedia = formData.get('socialMedia');
                    const taskType = formData.get('taskType');
                    const defaultImage = TaskManager.getDefaultImage(socialMedia, taskType);

                    TaskManager.createTask({
                        event_id: formData.get('eventId'),
                        title: formData.get('title'),
                        description: formData.get('description'),
                        social_media: socialMedia,
                        task_type: taskType,
                        deadline: formData.get('deadline'),
                        image: defaultImage
                    });

                    showAlert('Tarefa criada com sucesso!', 'success');
                    ModalHelper.close();
                    Renderer.renderApp();
                });
            },
            addTicketField() {
                const ticketFields = document.getElementById('ticketFields');
                const newField = document.createElement('div');
                newField.className = 'ticket-field';
                newField.innerHTML = `
                    <div class="grid grid-cols-2 gap-4 mb-3">
                        <div>
                            <label class="block text-gray-700 font-semibold mb-2">Nome do Lote</label>
                            <input type="text" name="ticketName[]" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:border-blue-900 focus:outline-none" placeholder="Ex: Lote Promocional" required>
                        </div>
                        <div>
                            <label class="block text-gray-700 font-semibold mb-2">Pre√ßo (R$)</label>
                            <input type="number" name="ticketPrice[]" min="0" step="0.01" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:border-blue-900 focus:outline-none" placeholder="0.00" required>
                        </div>
                    </div>
                    <div class="flex justify-between items-center">
                        <div>
                            <label class="block text-gray-700 font-semibold mb-2">Quantidade</label>
                            <input type="number" name="ticketQuantity[]" min="1" class="w-32 px-4 py-3 border border-gray-300 rounded-lg focus:border-blue-900 focus:outline-none" placeholder="100" required>
                        </div>
                        <button type="button" onclick="UI.removeTicketField(this)" class="remove-ticket-btn">
                            Remover
                        </button>
                    </div>
                `;
                ticketFields.appendChild(newField);
            },

            removeTicketField(button) {
                const ticketField = button.closest('.ticket-field');
                if (ticketField) {
                    ticketField.remove();
                }
            },
            showTaskSubmissionModal(taskId) {
                const task = AppState.tasks.get(taskId);
                if (!task) return;
                const html = `
                    <div class="fixed inset-0 bg-black/50 flex items-center justify-center p-4 z-50">
                        <div class="bg-white rounded-xl p-8 max-w-md w-full">
                            <div class="flex justify-between items-center mb-6">
                                <h3 class="text-2xl font-bold text-blue-900 font-['Poppins']">Enviar Tarefa</h3>
                                <button onclick="ModalHelper.close()" class="text-gray-500 hover:text-gray-700">
                                    <i class="fas fa-times text-xl"></i>
                                </button>
                            </div>
                            <div class="mb-6">
                                <h4 class="text-lg font-semibold mb-2">${task.title}</h4>
                                <p class="text-gray-600">${task.description}</p>
                            </div>
                            <form id="taskSubmissionForm">
                                <div class="mb-4">
                                    <label class="block text-gray-700 font-semibold mb-2">Link da Publica√ß√£o</label>
                                    <input type="url" name="link" required class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:border-blue-900 focus:outline-none" placeholder="https://...">
                                </div>
                                <div class="flex gap-4">
                                    <button type="button" onclick="ModalHelper.close()" class="flex-1 btn btn-secondary">
                                        Cancelar
                                    </button>
                                    <button type="submit" class="flex-1 btn btn-warning">
                                        Enviar
                                    </button>
                                </div>
                            </form>
                        </div>
                    </div>
                `;
                const modal = ModalHelper.open(html);
                if (!modal) return;
                const form = modal.querySelector('#taskSubmissionForm');
                form.addEventListener('submit', (e) => {
                    e.preventDefault();
                    const formData = new FormData(e.target);
                    TaskManager.submitTask(taskId, formData.get('link'));
                    showAlert('Tarefa enviada com sucesso!', 'success');
                    ModalHelper.close();
                    Renderer.renderApp();
                });
            },
            showEditProfileModal() {
                const user = AuthManager.getCurrentUser();
                const profile = AppState.userProfiles.get(user.id) || {};
                const html = `
                    <div class="fixed inset-0 bg-black/50 flex items-center justify-center p-4 z-50">
                        <div class="bg-white rounded-xl p-8 max-w-4xl w-full max-h-[90vh] overflow-y-auto">
                            <div class="flex justify-between items-center mb-6">
                                <h3 class="text-2xl font-bold text-blue-900 font-['Poppins']">Editar Perfil Completo</h3>
                                <button onclick="ModalHelper.close()" class="text-gray-500 hover:text-gray-700">
                                    <i class="fas fa-times text-xl"></i>
                                </button>
                            </div>
                            <form id="editProfileForm">
                                <div class="space-y-6">
                                    <!-- Dados Pessoais -->
                                    <div class="border-b pb-4">
                                        <h4 class="text-xl font-bold text-blue-900 mb-4"><i class="fas fa-user"></i> Dados Pessoais</h4>
                                        <div class="profile-grid">
                                            <div class="profile-field">
                                                <label>Nome Completo *</label>
                                                <input type="text" name="fullName" value="${profile.personalInfo?.fullName || user.name}" required>
                                            </div>
                                            <div class="profile-field">
                                                <label>Data de Nascimento</label>
                                                <input type="date" name="birthDate" value="${profile.personalInfo?.birthDate || ''}">
                                            </div>
                                            <div class="profile-field">
                                                <label>CPF</label>
                                                <input type="text" name="cpf" value="${profile.personalInfo?.cpf || ''}" placeholder="000.000.000-00">
                                            </div>
                                            <div class="profile-field">
                                                <label>RG</label>
                                                <input type="text" name="rg" value="${profile.personalInfo?.rg || ''}" placeholder="00.000.000-0">
                                            </div>
                                            <div class="profile-field">
                                                <label>G√™nero</label>
                                                <select name="gender">
                                                    <option value="">Selecione</option>
                                                    <option value="Masculino" ${profile.personalInfo?.gender === 'Masculino' ? 'selected' : ''}>Masculino</option>
                                                    <option value="Feminino" ${profile.personalInfo?.gender === 'Feminino' ? 'selected' : ''}>Feminino</option>
                                                    <option value="Outro" ${profile.personalInfo?.gender === 'Outro' ? 'selected' : ''}>Outro</option>
                                                    <option value="Prefiro n√£o informar" ${profile.personalInfo?.gender === 'Prefiro n√£o informar' ? 'selected' : ''}>Prefiro n√£o informar</option>
                                                </select>
                                            </div>
                                            <div class="profile-field">
                                                <label>Estado Civil</label>
                                                <select name="maritalStatus">
                                                    <option value="">Selecione</option>
                                                    <option value="Solteiro(a)" ${profile.personalInfo?.maritalStatus === 'Solteiro(a)' ? 'selected' : ''}>Solteiro(a)</option>
                                                    <option value="Casado(a)" ${profile.personalInfo?.maritalStatus === 'Casado(a)' ? 'selected' : ''}>Casado(a)</option>
                                                    <option value="Divorciado(a)" ${profile.personalInfo?.maritalStatus === 'Divorciado(a)' ? 'selected' : ''}>Divorciado(a)</option>
                                                    <option value="Vi√∫vo(a)" ${profile.personalInfo?.maritalStatus === 'Vi√∫vo(a)' ? 'selected' : ''}>Vi√∫vo(a)</option>
                                                </select>
                                            </div>
                                            <div class="profile-field">
                                                <label>Email *</label>
                                                <input type="email" name="email" value="${profile.email || user.email}" required>
                                            </div>
                                            <div class="profile-field">
                                                <label>Telefone</label>
                                                <input type="text" name="phone" value="${profile.phone || ''}" placeholder="(00) 00000-0000">
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Endere√ßo -->
                                    <div class="border-b pb-4">
                                        <h4 class="text-xl font-bold text-blue-900 mb-4"><i class="fas fa-map-marker-alt"></i> Endere√ßo</h4>
                                        <div class="profile-grid">
                                            <div class="profile-field">
                                                <label>CEP</label>
                                                <input type="text" name="cep" value="${profile.address?.cep || ''}" placeholder="00000-000" onblur="UI.searchCEP(this.value)">
                                            </div>
                                            <div class="profile-field">
                                                <label>Logradouro</label>
                                                <input type="text" name="street" value="${profile.address?.street || ''}">
                                            </div>
                                            <div class="profile-field">
                                                <label>N√∫mero</label>
                                                <input type="text" name="number" value="${profile.address?.number || ''}">
                                            </div>
                                            <div class="profile-field">
                                                <label>Complemento</label>
                                                <input type="text" name="complement" value="${profile.address?.complement || ''}">
                                            </div>
                                            <div class="profile-field">
                                                <label>Bairro</label>
                                                <input type="text" name="neighborhood" value="${profile.address?.neighborhood || ''}">
                                            </div>
                                            <div class="profile-field">
                                                <label>Cidade</label>
                                                <input type="text" name="city" value="${profile.address?.city || ''}">
                                            </div>
                                            <div class="profile-field">
                                                <label>Estado</label>
                                                <select name="state">
                                                    <option value="">Selecione</option>
                                                    ${Constants.STATES.map(state => `
                                                        <option value="${state}" ${profile.address?.state === state ? 'selected' : ''}>${state}</option>
                                                    `).join('')}
                                                </select>
                                            </div>
                                            <div class="profile-field">
                                                <label>Pa√≠s</label>
                                                <input type="text" name="country" value="${profile.address?.country || 'Brasil'}">
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Redes Sociais -->
                                    <div class="border-b pb-4">
                                        <h4 class="text-xl font-bold text-blue-900 mb-4"><i class="fas fa-share-alt"></i> Redes Sociais</h4>
                                        <div class="profile-grid">
                                            <div class="profile-field">
                                                <label>Instagram</label>
                                                <input type="url" name="instagram" value="${profile.socialLinks?.instagram || ''}" placeholder="https://instagram.com/seuuser">
                                            </div>
                                            <div class="profile-field">
                                                <label>Facebook</label>
                                                <input type="url" name="facebook" value="${profile.socialLinks?.facebook || ''}" placeholder="https://facebook.com/seuuser">
                                            </div>
                                            <div class="profile-field">
                                                <label>TikTok</label>
                                                <input type="url" name="tiktok" value="${profile.socialLinks?.tiktok || ''}" placeholder="https://tiktok.com/@seuuser">
                                            </div>
                                            <div class="profile-field">
                                                <label>LinkedIn</label>
                                                <input type="url" name="linkedin" value="${profile.socialLinks?.linkedin || ''}" placeholder="https://linkedin.com/in/seuuser">
                                            </div>
                                            <div class="profile-field">
                                                <label>YouTube</label>
                                                <input type="url" name="youtube" value="${profile.socialLinks?.youtube || ''}" placeholder="https://youtube.com/c/seucanal">
                                            </div>
                                            <div class="profile-field">
                                                <label>Site/Portf√≥lio</label>
                                                <input type="url" name="website" value="${profile.socialLinks?.website || ''}" placeholder="https://seusite.com">
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Informa√ß√µes M√©dicas -->
                                    <div>
                                        <h4 class="text-xl font-bold text-blue-900 mb-4"><i class="fas fa-heartbeat"></i> Informa√ß√µes para Primeiros Socorros</h4>
                                        <div class="profile-grid">
                                            <div class="profile-field">
                                                <label>Tipo Sangu√≠neo</label>
                                                <select name="bloodType">
                                                    <option value="">Selecione</option>
                                                    <option value="A+" ${profile.medicalInfo?.bloodType === 'A+' ? 'selected' : ''}>A+</option>
                                                    <option value="A-" ${profile.medicalInfo?.bloodType === 'A-' ? 'selected' : ''}>A-</option>
                                                    <option value="B+" ${profile.medicalInfo?.bloodType === 'B+' ? 'selected' : ''}>B+</option>
                                                    <option value="B-" ${profile.medicalInfo?.bloodType === 'B-' ? 'selected' : ''}>B-</option>
                                                    <option value="AB+" ${profile.medicalInfo?.bloodType === 'AB+' ? 'selected' : ''}>AB+</option>
                                                    <option value="AB-" ${profile.medicalInfo?.bloodType === 'AB-' ? 'selected' : ''}>AB-</option>
                                                    <option value="O+" ${profile.medicalInfo?.bloodType === 'O+' ? 'selected' : ''}>O+</option>
                                                    <option value="O-" ${profile.medicalInfo?.bloodType === 'O-' ? 'selected' : ''}>O-</option>
                                                </select>
                                            </div>
                                            <div class="profile-field">
                                                <label>Alergias</label>
                                                <textarea name="allergies" placeholder="Liste suas alergias...">${profile.medicalInfo?.allergies || ''}</textarea>
                                            </div>
                                            <div class="profile-field">
                                                <label>Medicamentos em Uso</label>
                                                <textarea name="medications" placeholder="Liste medicamentos de uso cont√≠nuo...">${profile.medicalInfo?.medications || ''}</textarea>
                                            </div>
                                            <div class="profile-field">
                                                <label>Doen√ßas Pr√©-existentes</label>
                                                <textarea name="conditions" placeholder="Liste doen√ßas ou condi√ß√µes m√©dicas...">${profile.medicalInfo?.conditions || ''}</textarea>
                                            </div>
                                            <div class="profile-field">
                                                <label>Contato de Emerg√™ncia - Nome</label>
                                                <input type="text" name="emergencyName" value="${profile.medicalInfo?.emergencyContact?.name || ''}">
                                            </div>
                                            <div class="profile-field">
                                                <label>Contato de Emerg√™ncia - Telefone</label>
                                                <input type="text" name="emergencyPhone" value="${profile.medicalInfo?.emergencyContact?.phone || ''}" placeholder="(00) 00000-0000">
                                            </div>
                                            <div class="profile-field">
                                                <label>Parentesco</label>
                                                <input type="text" name="emergencyRelationship" value="${profile.medicalInfo?.emergencyContact?.relationship || ''}" placeholder="Ex: Pai, M√£e, C√¥njuge...">
                                            </div>
                                            <div class="profile-field">
                                                <label>Plano de Sa√∫de</label>
                                                <input type="text" name="healthInsurance" value="${profile.medicalInfo?.healthInsurance || ''}">
                                            </div>
                                            <div class="profile-field">
                                                <label>Observa√ß√µes Adicionais</label>
                                                <textarea name="additionalNotes" placeholder="Outras informa√ß√µes m√©dicas relevantes...">${profile.medicalInfo?.additionalNotes || ''}</textarea>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="flex gap-4 mt-6">
                                    <button type="button" onclick="ModalHelper.close()" class="flex-1 btn btn-secondary">
                                        Cancelar
                                    </button>
                                    <button type="submit" class="flex-1 btn btn-success">
                                        Salvar Altera√ß√µes
                                    </button>
                                </div>
                            </form>
                        </div>
                    </div>
                `;
                const modal = ModalHelper.open(html);
                if (!modal) return;
                const form = modal.querySelector('#editProfileForm');
                form.addEventListener('submit', (e) => {
                    e.preventDefault();
                    const formData = new FormData(e.target);
                    const user = AuthManager.getCurrentUser();
                    const currentProfile = AppState.userProfiles.get(user.id) || {};
                    const personalInfo = {
                        fullName: formData.get('fullName'),
                        birthDate: formData.get('birthDate'),
                        cpf: formData.get('cpf'),
                        rg: formData.get('rg'),
                        gender: formData.get('gender'),
                        maritalStatus: formData.get('maritalStatus')
                    };
                    const address = {
                        cep: formData.get('cep'),
                        street: formData.get('street'),
                        number: formData.get('number'),
                        complement: formData.get('complement'),
                        neighborhood: formData.get('neighborhood'),
                        city: formData.get('city'),
                        state: formData.get('state'),
                        country: formData.get('country')
                    };
                    const socialLinks = {};
                    const socialFields = ['instagram', 'facebook', 'tiktok', 'linkedin', 'youtube', 'website'];
                    socialFields.forEach(field => {
                        const value = formData.get(field);
                        if (value) socialLinks[field] = value;
                    });
                    const medicalInfo = {
                        bloodType: formData.get('bloodType'),
                        allergies: formData.get('allergies'),
                        medications: formData.get('medications'),
                        conditions: formData.get('conditions'),
                        emergencyContact: {
                            name: formData.get('emergencyName'),
                            phone: formData.get('emergencyPhone'),
                            relationship: formData.get('emergencyRelationship')
                        },
                        healthInsurance: formData.get('healthInsurance'),
                        additionalNotes: formData.get('additionalNotes')
                    };
                    const updatedProfile = {
                        ...currentProfile,
                        name: formData.get('fullName'),
                        email: formData.get('email'),
                        phone: formData.get('phone'),
                        personalInfo,
                        address,
                        socialLinks,
                        medicalInfo
                    };
                    AppState.userProfiles.set(user.id, updatedProfile);
                    showAlert('Perfil atualizado com sucesso!', 'success');
                    ModalHelper.close();
                    Renderer.renderApp();
                });
            },
            searchCEP(cep) {
                if (!cep || cep.length !== 9) return;

                showAlert('Buscando informa√ß√µes do CEP...', 'info');

                setTimeout(() => {
                    const mockAddress = {
                        '01234-567': {
                            street: 'Rua das Flores',
                            neighborhood: 'Centro',
                            city: 'S√£o Paulo',
                            state: 'SP'
                        },
                        '04567-890': {
                            street: 'Avenida Paulista',
                            neighborhood: 'Bela Vista',
                            city: 'S√£o Paulo',
                            state: 'SP'
                        }
                    };

                    const address = mockAddress[cep];
                    if (address) {
                        const form = document.querySelector('#editProfileForm');
                        if (form) {
                            form.querySelector('[name="street"]').value = address.street;
                            form.querySelector('[name="neighborhood"]').value = address.neighborhood;
                            form.querySelector('[name="city"]').value = address.city;
                            form.querySelector('[name="state"]').value = address.state;
                        }
                        showAlert('Endere√ßo preenchido automaticamente!', 'success');
                    } else {
                        showAlert('CEP n√£o encontrado. Preencha os dados manualmente.', 'warning');
                    }
                }, 1000);
            },
            showUploadPhotoModal() {
                const html = `
                    <div class="fixed inset-0 bg-black/50 flex items-center justify-center p-4 z-50">
                        <div class="bg-white rounded-xl p-8 max-w-md w-full">
                            <div class="flex justify-between items-center mb-6">
                                <h3 class="text-2xl font-bold text-blue-900 font-['Poppins']">Alterar Foto de Perfil</h3>
                                <button onclick="ModalHelper.close()" class="text-gray-500 hover:text-gray-700">
                                    <i class="fas fa-times text-xl"></i>
                                </button>
                            </div>

                            <div class="text-center mb-6">
                                <div class="relative inline-block">
                                    <img id="currentProfilePhoto" src="${AppState.userProfiles.get(AuthManager.getCurrentUser().id)?.profilePicture || 'https://via.placeholder.com/150'}" 
                                         class="w-32 h-32 rounded-full object-cover border-4 border-white shadow-lg mx-auto">
                                    <div class="absolute inset-0 rounded-full bg-black/50 flex items-center justify-center opacity-0 hover:opacity-100 transition-opacity">
                                        <span class="text-white text-sm font-semibold">Pr√©via</span>
                                    </div>
                                </div>
                            </div>

                            <form id="uploadPhotoForm">
                                <div class="space-y-4">
                                    <div>
                                        <label class="block text-gray-700 font-semibold mb-2">Selecionar Nova Imagem</label>
                                        <div class="border-2 border-dashed border-gray-300 rounded-lg p-6 text-center hover:border-blue-900 transition-colors">
                                            <input type="file" id="profilePhotoInput" accept="image/*" class="hidden">
                                            <div id="uploadArea" class="cursor-pointer">
                                                <i class="fas fa-cloud-upload-alt text-3xl text-gray-400 mb-2"></i>
                                                <p class="text-gray-600">Clique para selecionar ou arraste uma imagem</p>
                                                <p class="text-gray-500 text-sm mt-1">JPEG, PNG ou GIF (m√°x. 5MB)</p>
                                            </div>
                                        </div>
                                        <div id="profilePhotoPreview" class="mt-4 text-center"></div>
                                    </div>

                                    <div id="uploadProgress" class="hidden">
                                        <div class="flex justify-between text-sm text-gray-600 mb-1">
                                            <span>Enviando...</span>
                                            <span id="progressPercent">0%</span>
                                        </div>
                                        <div class="w-full bg-gray-200 rounded-full h-2">
                                            <div id="progressBar" class="bg-blue-900 h-2 rounded-full transition-all duration-300" style="width: 0%"></div>
                                        </div>
                                    </div>
                                </div>

                                <div class="flex gap-4 mt-6">
                                    <button type="button" onclick="ModalHelper.close()" class="flex-1 btn btn-secondary">
                                        Cancelar
                                    </button>
                                    <button type="submit" id="uploadButton" class="flex-1 btn btn-warning" disabled>
                                        <i class="fas fa-upload"></i> Alterar Foto
                                    </button>
                                </div>
                            </form>
                        </div>
                    </div>
                `;
                const modal = ModalHelper.open(html);
                this.initializePhotoUpload(modal);
            },
            initializePhotoUpload(modal) {
                const fileInput = modal.querySelector('#profilePhotoInput');
                const uploadArea = modal.querySelector('#uploadArea');
                const preview = modal.querySelector('#profilePhotoPreview');
                const uploadButton = modal.querySelector('#uploadButton');
                const progress = modal.querySelector('#uploadProgress');
                const progressBar = modal.querySelector('#progressBar');
                const progressPercent = modal.querySelector('#progressPercent');
                uploadArea.addEventListener('click', () => fileInput.click());
                uploadArea.addEventListener('dragover', (e) => {
                    e.preventDefault();
                    uploadArea.classList.add('border-blue-900', 'bg-blue-50');
                });
                uploadArea.addEventListener('dragleave', () => {
                    uploadArea.classList.remove('border-blue-900', 'bg-blue-50');
                });
                uploadArea.addEventListener('drop', (e) => {
                    e.preventDefault();
                    uploadArea.classList.remove('border-blue-900', 'bg-blue-50');
                    if (e.dataTransfer.files.length) {
                        fileInput.files = e.dataTransfer.files;
                        this.handleFileSelect(fileInput.files[0], preview, uploadButton, progress, progressBar, progressPercent);
                    }
                });
                fileInput.addEventListener('change', (e) => {
                    if (e.target.files.length) {
                        this.handleFileSelect(e.target.files[0], preview, uploadButton, progress, progressBar, progressPercent);
                    }
                });
                const form = modal.querySelector('#uploadPhotoForm');
                form.addEventListener('submit', async (e) => {
                    e.preventDefault();
                    await this.handlePhotoUpload(fileInput.files[0], modal);
                });
            },
            handleFileSelect(file, preview, uploadButton, progress, progressBar, progressPercent) {
                if (!file) return;
                try {
                    ProfilePhotoManager.validatePhoto(file);

                    const reader = new FileReader();
                    reader.onload = (e) => {
                        preview.innerHTML = `
                            <div class="relative inline-block">
                                <img src="${e.target.result}" class="w-32 h-32 rounded-full object-cover border-4 border-green-500 shadow-lg">
                                <div class="absolute inset-0 rounded-full bg-black/50 flex items-center justify-center opacity-0 hover:opacity-100 transition-opacity">
                                    <span class="text-white text-sm font-semibold">Nova Foto</span>
                                </div>
                            </div>
                        `;
                        uploadButton.disabled = false;
                    };
                    reader.readAsDataURL(file);

                } catch (error) {
                    showAlert(error.message, 'error');
                    uploadButton.disabled = true;
                }
            },
            async handlePhotoUpload(file, modal) {
                if (!file) return;
                try {
                    const progress = modal.querySelector('#uploadProgress');
                    const progressBar = modal.querySelector('#progressBar');
                    const progressPercent = modal.querySelector('#progressPercent');

                    progress.classList.remove('hidden');

                    for (let i = 0; i <= 100; i += 10) {
                        await new Promise(resolve => setTimeout(resolve, 100));
                        progressBar.style.width = `${i}%`;
                        progressPercent.textContent = `${i}%`;
                    }

                    const imageData = await ProfilePhotoManager.uploadProfilePhoto(file);

                    const user = AuthManager.getCurrentUser();
                    const profile = AppState.userProfiles.get(user.id);
                    if (profile) {
                        profile.profilePicture = imageData;
                        AppState.userProfiles.set(user.id, profile);
                    }

                    showAlert('Foto de perfil atualizada com sucesso!', 'success');
                    ModalHelper.close();
                    Renderer.renderApp();

                } catch (error) {
                    showAlert('Erro ao fazer upload da imagem: ' + error.message, 'error');
                }
            },
            showAddSocialLinkModal(platform) {
                const profile = AppState.userProfiles.get(AuthManager.getCurrentUser().id);
                const currentUrl = profile?.socialLinks?.[platform] || '';

                const platformNames = {
                    instagram: 'Instagram',
                    facebook: 'Facebook',
                    tiktok: 'TikTok',
                    linkedin: 'LinkedIn',
                    youtube: 'YouTube',
                    twitter: 'Twitter',
                    website: 'Site/Portf√≥lio'
                };
                const html = `
                    <div class="fixed inset-0 bg-black/50 flex items-center justify-center p-4 z-50">
                        <div class="bg-white rounded-xl p-8 max-w-md w-full">
                            <div class="flex justify-between items-center mb-6">
                                <h3 class="text-2xl font-bold text-blue-900">
                                    <i class="${SocialProfileManager.getSocialIcon(platform)}"></i>
                                    ${platformNames[platform]}
                                </h3>
                                <button onclick="ModalHelper.close()" class="text-gray-500 hover:text-gray-700">
                                    <i class="fas fa-times text-xl"></i>
                                </button>
                            </div>

                            <form id="socialLinkForm">
                                <div class="space-y-4">
                                    <div>
                                        <label class="block text-gray-700 font-semibold mb-2">URL do Perfil</label>
                                        <input type="url" name="socialUrl" value="${currentUrl}" 
                                               class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:border-blue-900 focus:outline-none" 
                                               placeholder="https://${platform}.com/seuusuario" required>
                                        <p class="text-gray-500 text-sm mt-1">Exemplo: https://${platform}.com/seuusuario</p>
                                    </div>
                                </div>

                                <div class="flex gap-4 mt-6">
                                    ${currentUrl ? `
                                        <button type="button" onclick="UI.removeSocialLink('${platform}')" class="flex-1 btn btn-danger">
                                            Remover
                                        </button>
                                    ` : `
                                        <button type="button" onclick="ModalHelper.close()" class="flex-1 btn btn-secondary">
                                            Cancelar
                                        </button>
                                    `}
                                    <button type="submit" class="flex-1 btn btn-success">
                                        ${currentUrl ? 'Atualizar' : 'Adicionar'}
                                    </button>
                                </div>
                            </form>
                        </div>
                    </div>
                `;
                const modal = ModalHelper.open(html);
                const form = modal.querySelector('#socialLinkForm');

                form.addEventListener('submit', (e) => {
                    e.preventDefault();
                    const formData = new FormData(e.target);
                    const url = formData.get('socialUrl');

                    try {
                        SocialProfileManager.validateSocialUrl(platform, url);
                        this.saveSocialLink(platform, url);
                        ModalHelper.close();
                    } catch (error) {
                        showAlert(error.message, 'error');
                    }
                });
            },
            saveSocialLink(platform, url) {
                const user = AuthManager.getCurrentUser();
                const profile = AppState.userProfiles.get(user.id);

                if (!profile.socialLinks) {
                    profile.socialLinks = {};
                }

                if (url) {
                    profile.socialLinks[platform] = url;
                } else {
                    delete profile.socialLinks[platform];
                }

                AppState.userProfiles.set(user.id, profile);
                showAlert(`Link do ${platform} ${url ? 'adicionado' : 'removido'} com sucesso!`, 'success');
                Renderer.renderApp();
            },
            removeSocialLink(platform) {
                if (confirm(`Tem certeza que deseja remover o link do ${platform}?`)) {
                    this.saveSocialLink(platform, null);
                    ModalHelper.close();
                }
            },
            setPromoterView(view) {
                AppState.ui.promoterViewMode = view;
                Renderer.renderApp();
            },
            setProfileTab(tab) {
                AppState.ui.profileTab = tab;
                Renderer.renderApp();
            },
            showEventDetail(eventId) {
                const event = EventManager.getEventById(eventId);
                if (!event) return;
                const eventTasks = TaskManager.getEventTasks(eventId);
                const eventImages = EventManager.getEventImages(eventId);

                const html = `
                    <div class="fixed inset-0 bg-black/50 flex items-center justify-center p-4 z-50">
                        <div class="bg-white rounded-xl p-8 max-w-4xl w-full max-h-[90vh] overflow-y-auto">
                            <div class="flex justify-between items-center mb-6">
                                <h3 class="text-2xl font-bold text-blue-900 font-['Poppins']">${event.name}</h3>
                                <button onclick="ModalHelper.close()" class="text-gray-500 hover:text-gray-700">
                                    <i class="fas fa-times text-xl"></i>
                                </button>
                            </div>

                            <div class="grid md:grid-cols-2 gap-6 mb-6">
                                <img src="${event.image}" alt="${event.name}" class="w-full h-64 object-cover rounded-lg">
                                <div>
                                    <h4 class="text-lg font-semibold mb-2">Informa√ß√µes do Evento</h4>
                                    <div class="space-y-2">
                                        <p><strong>Local:</strong> ${event.location}</p>
                                        <p><strong>Data:</strong> ${FormatHelper.date(event.start_date)}</p>
                                        <p><strong>Descri√ß√£o:</strong> ${event.description}</p>
                                    </div>
                                </div>
                            </div>

                            <!-- Se√ß√£o de Imagens do Evento para Divulgadores -->
                            ${eventImages.length > 0 ? `
                                <div class="event-images-section">
                                    <div class="event-images-header">
                                        <h4 class="event-images-title">
                                            <i class="fas fa-images"></i> Imagens do Evento
                                        </h4>
                                        <p class="text-gray-600 text-sm">Baixe as imagens oficiais para usar em suas divulga√ß√µes</p>
                                    </div>
                                    <div id="eventCarouselContainer"></div>
                                    <div class="mt-4 text-center">
                                        <p class="text-gray-600 text-sm">Clique no bot√£o de download <i class="fas fa-download"></i> em qualquer imagem para baix√°-la</p>
                                    </div>
                                </div>
                            ` : ''}

                            <h4 class="text-lg font-semibold mb-4">Tarefas Dispon√≠veis</h4>
                            <div class="space-y-4">
                                ${eventTasks.length > 0 ? 
                                    TemplateHelpers.loop(eventTasks, task => TaskTemplates.card(task, { showSubmission: true })) : 
                                    '<p class="text-gray-500">Nenhuma tarefa dispon√≠vel para este evento.</p>'
                                }
                            </div>
                        </div>
                    </div>
                `;
                const modal = ModalHelper.open(html);

                if (eventImages.length > 0) {
                    setTimeout(() => {
                        CarouselManager.initCarousel('eventCarouselContainer', eventImages);
                    }, 100);
                }
            },
            showEventEditModal(eventId) {
                const event = EventManager.getEventById(eventId);
                if (!event) return;
                const html = `
                    <div class="fixed inset-0 bg-black/50 flex items-center justify-center p-4 z-50">
                        <div class="bg-white rounded-xl p-8 max-w-2xl w-full max-h-[90vh] overflow-y-auto">
                            <div class="flex justify-between items-center mb-6">
                                <h3 class="text-2xl font-bold text-blue-900 font-['Poppins']">Editar Evento: ${event.name}</h3>
                                <button onclick="ModalHelper.close()" class="text-gray-500 hover:text-gray-700">
                                    <i class="fas fa-times text-xl"></i>
                                </button>
                            </div>
                            <form id="editEventForm">
                                <div class="space-y-4">
                                    <div>
                                        <label class="block text-gray-700 font-semibold mb-2">Nome do Evento</label>
                                        <input type="text" name="name" value="${event.name}" required class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:border-blue-900 focus:outline-none">
                                    </div>
                                    <div>
                                        <label class="block text-gray-700 font-semibold mb-2">Local</label>
                                        <input type="text" name="location" value="${event.location}" required class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:border-blue-900 focus:outline-none">
                                    </div>
                                    <div class="grid grid-cols-2 gap-4">
                                        <div>
                                            <label class="block text-gray-700 font-semibold mb-2">Data de In√≠cio</label>
                                        <input type="date" name="startDate" value="${event.start_date}" required class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:border-blue-900 focus:outline-none">
                                        </div>
                                        <div>
                                            <label class="block text-gray-700 font-semibold mb-2">Data de Fim</label>
                                            <input type="date" name="endDate" value="${event.end_date}" required class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:border-blue-900 focus:outline-none">
                                        </div>
                                    </div>
                                    <div>
                                        <label class="block text-gray-700 font-semibold mb-2">Categoria</label>
                                        <select name="category" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:border-blue-900 focus:outline-none">
                                            <option value="">Selecione uma categoria</option>
                                            <option value="M√∫sica" ${event.category === 'M√∫sica' ? 'selected' : ''}>M√∫sica</option>
                                            <option value="Educa√ß√£o" ${event.category === 'Educa√ß√£o' ? 'selected' : ''}>Educa√ß√£o</option>
                                            <option value="Artesanato" ${event.category === 'Artesanato' ? 'selected' : ''}>Artesanato</option>
                                            <option value="Esportes" ${event.category === 'Esportes' ? 'selected' : ''}>Esportes</option>
                                            <option value="Gastronomia" ${event.category === 'Gastronomia' ? 'selected' : ''}>Gastronomia</option>
                                            <option value="Tecnologia" ${event.category === 'Tecnologia' ? 'selected' : ''}>Tecnologia</option>
                                        </select>
                                    </div>
                                    <div>
                                        <label class="block text-gray-700 font-semibold mb-2">Descri√ß√£o</label>
                                        <textarea name="description" rows="3" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:border-blue-900 focus:outline-none">${event.description}</textarea>
                                    </div>
                                </div>
                                <div class="flex gap-4 mt-6">
                                    <button type="button" onclick="ModalHelper.close()" class="flex-1 btn btn-secondary">
                                        Cancelar
                                    </button>
                                    <button type="submit" class="flex-1 btn btn-success">
                                        Atualizar Evento
                                    </button>
                                </div>
                            </form>
                        </div>
                    </div>
                `;
                const modal = ModalHelper.open(html);
                if (!modal) return;
                const form = modal.querySelector('#editEventForm');
                form.addEventListener('submit', async (e) => {
                    e.preventDefault();
                    const formData = new FormData(e.target);

                    EventManager.updateEvent(eventId, {
                        name: formData.get('name'),
                        location: formData.get('location'),
                        start_date: formData.get('startDate'),
                        end_date: formData.get('endDate'),
                        category: formData.get('category'),
                        description: formData.get('description')
                    });

                    showAlert('Evento atualizado com sucesso!', 'success');
                    ModalHelper.close();
                    Renderer.renderApp();
                });
            },
            toggleNotifications() {
                const dropdown = document.getElementById('notificationsDropdown');
                if (!dropdown) return;

                if (dropdown.classList.contains('hidden')) {
                    dropdown.classList.remove('hidden');
                    if (dropdown.innerHTML.trim() === '') {
                        NotificationSystem.renderNotifications();
                    }
                } else {
                    dropdown.classList.add('hidden');
                }
            },
            generateProfilePDF() {
                showAlert('Funcionalidade de exporta√ß√£o em PDF ser√° implementada em breve!', 'info');
            },
            generateMedicalCard() {
                const user = AuthManager.getCurrentUser();
                const profile = AppState.userProfiles.get(user.id);
                const medicalInfo = profile?.medicalInfo || {};
                const emergencyContact = medicalInfo.emergencyContact || {};
                const medicalCardHTML = `
                    <div class="bg-white p-6 rounded-lg shadow-lg max-w-md mx-auto">
                        <h3 class="text-xl font-bold text-red-600 mb-4 text-center">FICHA M√âDICA DE EMERG√äNCIA</h3>
                        <div class="space-y-3">
                            <div><strong>Nome:</strong> ${profile?.name || user.name}</div>
                            <div><strong>Tipo Sangu√≠neo:</strong> ${medicalInfo.bloodType || 'N√£o informado'}</div>
                            <div><strong>Alergias:</strong> ${medicalInfo.allergies || 'Nenhuma'}</div>
                            <div><strong>Medicamentos:</strong> ${medicalInfo.medicamentos || 'Nenhum'}</div>
                            <div><strong>Condi√ß√µes M√©dicas:</strong> ${medicalInfo.conditions || 'Nenhuma'}</div>
                            <div><strong>Contato de Emerg√™ncia:</strong> ${emergencyContact.name || 'N√£o informado'} - ${emergencyContact.phone || ''}</div>
                            <div><strong>Parentesco:</strong> ${emergencyContact.relationship || ''}</div>
                            <div><strong>Plano de Sa√∫de:</strong> ${medicalInfo.healthInsurance || 'N√£o informado'}</div>
                        </div>
                        <div class="mt-4 text-xs text-gray-500 text-center">
                            Esta informa√ß√£o deve √© usada apenas em situa√ß√µes de emerg√™ncia m√©dica.
                        </div>
                    </div>
                `;
                const modal = ModalHelper.open(`
                    <div class="fixed inset-0 bg-black/50 flex items-center justify-center p-4 z-50">
                        <div class="bg-white rounded-xl p-8 max-w-md w-full">
                            <div class="flex justify-between items-center mb-6">
                                <h3 class="text-2xl font-bold text-blue-900">Ficha M√©dica</h3>
                                <button onclick="ModalHelper.close()" class="text-gray-500 hover:text-gray-700">
                                    <i class="fas fa-times text-xl"></i>
                                </button>
                            </div>
                            ${medicalCardHTML}
                            <div class="mt-6 flex gap-4">
                                <button onclick="window.print()" class="flex-1 btn btn-primary">
                                    <i class="fas fa-print"></i> Imprimir
                                </button>
                                <button onclick="ModalHelper.close()" class="flex-1 btn btn-secondary">
                                    Fechar
                                </button>
                            </div>
                        </div>
                    </div>
                `);
            }
        };
        // === SISTEMA DE NOTIFICA√á√ïES ORIGINAL COMPLETO ===
        const NotificationSystem = {
            renderNotifications() {
                const user = AuthManager.getCurrentUser();
                if (!user) return;

                const userNotifications = AppState.notifications
                    .filter(n => n.userId === user.id)
                    .slice(0, 10);

                this.updateNotificationBadge(userNotifications);
                this.updateNotificationDropdown(userNotifications);
            },

            updateNotificationBadge(notifications) {
                const unreadCount = notifications.filter(n => !n.read).length;
                const badge = document.querySelector('.notification-badge');

                if (badge) {
                    if (unreadCount > 0) {
                        badge.textContent = unreadCount > 99 ? '99+' : unreadCount.toString();
                        badge.style.display = 'flex';
                    } else {
                        badge.style.display = 'none';
                    }
                }
            },

            updateNotificationDropdown(notifications) {
                const dropdown = document.getElementById('notificationsDropdown');
                if (!dropdown) return;
                if (notifications.length === 0) {
                    dropdown.innerHTML = `
                        <div class="notification-item">
                            <div class="notification-message text-center py-4">Nenhuma notifica√ß√£o</div>
                        </div>
                    `;
                } else {
                    dropdown.innerHTML = notifications.map(notification => `
                        <div class="notification-item ${!notification.read ? 'unread' : ''}" 
                             onclick="NotificationSystem.markAsRead('${notification.id}')">
                            <div class="notification-title">${notification.title}</div>
                            <div class="notification-message">${notification.message}</div>
                            <div class="notification-time">${FormatHelper.timeAgo(notification.createdAt)}</div>
                        </div>
                    `).join('');
                }
            },

            markAsRead(notificationId) {
                const notification = AppState.notifications.find(n => n.id === notificationId);
                if (notification && !notification.read) {
                    notification.read = true;
                    this.renderNotifications();
                    const dropdown = document.getElementById('notificationsDropdown');
                    if (dropdown) {
                        dropdown.classList.add('hidden');
                    }
                }
            }
        };
        // === SISTEMA DE PERFIL ORIGINAL COMPLETO ===
        const ProfileManager = {
            openProfile() {
                if (!AuthManager.isLoggedIn()) {
                    showAlert('Voc√™ precisa estar logado para acessar o perfil', 'warning');
                    return;
                }

                AppState.ui.currentPage = 'profile';
                AppState.ui.profileSection = 'view';
                Renderer.renderApp();
            }
        };
        // === SISTEMA DE BUSCA E FILTROS ORIGINAL COMPLETO ===
        const SearchManager = {
            performSearch() {
                const searchInput = document.getElementById('searchInput');
                if (searchInput) {
                    AppState.ui.searchQuery = searchInput.value;
                    Renderer.renderApp();
                }
            },
            setFilter(type, value) {
                AppState.ui.activeFilters[type] = value;
                Renderer.renderApp();
            },
            clearFilter(type) {
                AppState.ui.activeFilters[type] = '';
                Renderer.renderApp();
            }
        };
        // === SISTEMA DE UPLOAD DE IMAGENS ORIGINAL COMPLETO ===
        const ImageUploader = {
            async upload(file) {
                return new Promise((resolve) => {
                    setTimeout(() => {
                        const imageUrls = [
                            Constants.DEFAULT_IMAGES.EVENT,
                            'https://images.unsplash.com/photo-1501281668745-f7f57925c3b4?ixlib=rb-4.0.3&auto=format&fit=crop&w=600&q=80',
                            'https://images.unsplash.com/photo-1551434678-e076c223a692?ixlib=rb-4.0.3&auto=format&fit=crop&w=600&q=80'
                        ];
                        const randomImage = imageUrls[Math.floor(Math.random() * imageUrls.length)];
                        resolve(randomImage);
                    }, 1000);
                });
            },
            previewImage(input, previewElementId) {
                const file = input.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        const previewElement = document.getElementById(previewElementId);
                        if (previewElement) {
                            previewElement.innerHTML = `
                                <img src="${e.target.result}" class="image-preview w-full rounded-lg" alt="Preview">
                            `;
                        }
                    };
                    reader.readAsDataURL(file);
                }
            },
            async handleImageUpload(imageFile, defaultImage) {
                if (!imageFile) return defaultImage;

                showAlert('Fazendo upload da imagem...', 'info');
                try {
                    return await this.upload(imageFile);
                } catch (error) {
                    showAlert('Erro no upload da imagem. Usando imagem padr√£o.', 'warning');
                    return defaultImage;
                }
            }
        };
        // === HELPERS DE MODAL E ALERTAS ORIGINAIS COMPLETOS ===
        const ModalHelper = {
            open(html) {
                const modal = document.getElementById('modalContainer');
                if (!modal) return null;
                modal.innerHTML = html;
                modal.classList.remove('hidden');
                return modal;
            },

            close() {
                const modal = document.getElementById('modalContainer');
                if (modal) modal.classList.add('hidden');
            }
        };
        const Actions = {
            downloadImage(imageUrl, fileName) {
                const link = document.createElement('a');
                link.href = imageUrl;
                link.download = (fileName || 'imagem') + '.jpg';
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                showAlert('Download da imagem iniciado!', 'success');
            },
            copyToClipboard(text) {
                navigator.clipboard.writeText(text).then(() => {
                    showAlert('Texto copiado para a √°rea de transfer√™ncia!', 'success');
                }).catch(err => {
                    showAlert('Erro ao copiar texto', 'error');
                });
            }
        };
        function showAlert(message, type = 'info') {
            const alertContainer = document.getElementById('alertContainer');
            if (!alertContainer) return;

            const alertId = Date.now();
            const alertColors = {
                success: 'bg-green-500',
                error: 'bg-red-500',
                info: 'bg-blue-500',
                warning: 'bg-yellow-500'
            };

            const alertDiv = document.createElement('div');
            alertDiv.id = `alert-${alertId}`;
            alertDiv.className = `${alertColors[type]} text-white px-6 py-4 rounded-lg shadow-lg alert-slide max-w-sm`;
            alertDiv.innerHTML = `
                <div class="flex justify-between items-center">
                    <span>${message}</span>
                    <button onclick="document.getElementById('alert-${alertId}').remove()" class="ml-4 text-white hover:text-gray-200">
                        ‚úï
                    </button>
                </div>
            `;

            alertContainer.appendChild(alertDiv);
            setTimeout(() => {
                const alert = document.getElementById(`alert-${alertId}`);
                if (alert) alert.remove();
            }, 5000);
        }
        // === INICIALIZA√á√ÉO SEGURA ===
        function initApp() {
            // Iniciar sistemas de seguran√ßa primeiro
            SecuritySystem.init();

            // Inicializar dados e autentica√ß√£o
            AppState.initializeDemoData();
            AuthManager.init();

            // Renderizar aplica√ß√£o
            Renderer.renderApp();

            // Mostrar alerta de boas-vindas seguro
            setTimeout(() => {
                showAlert('Bem-vindo ao DIVULGOSIM - Sistema Protegido!', 'info');
            }, 1000);
        }
        // Iniciar aplica√ß√£o quando DOM estiver pronto
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', initApp);
        } else {
            initApp();
        }
    </script>
</body>
</html>